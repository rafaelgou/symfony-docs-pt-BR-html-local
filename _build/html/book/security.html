

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Segurança &mdash; Symfony2Docs 2.0.x documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.0.x',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Symfony2Docs 2.0.x documentation" href="../index.html" />
    <link rel="up" title="Livro" href="index.html" />
    <link rel="next" title="HTTP Cache" href="http_cache.html" />
    <link rel="prev" title="Formulários" href="forms.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="http_cache.html" title="HTTP Cache"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="forms.html" title="Formulários"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Symfony2Docs 2.0.x documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Livro</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="seguranca">
<h1>Segurança<a class="headerlink" href="#seguranca" title="Permalink to this headline">¶</a></h1>
<p>Segurança é um processo em dois passos principais. Seu objetivo é evitar que
um usuário tenha acesso a um recurso que ele não deveria ter.</p>
<p>No primeiro passo do processo, o sistema de segurança identifica quem o usuário é
exigindo que o mesmo envie algum tipo de identificação. Este primeiro passo é
chamado <strong>autenticação</strong> e signifcica que o sistema está tentando identificar
que é o usuário.</p>
<p>Uma vez que o sistema sabe quem está acessando, o próximo passo é determinar se o
usuário pode acessar determinado recurso. Este segundo passo é chamado
de <strong>autorização</strong> e significa que o sistema irá checar se o usuário tem permissão para
executar determinada ação.</p>
<img alt="../_images/security_authentication_authorization.png" class="align-center" src="../_images/security_authentication_authorization.png" />
<p>Como a melhor maneira de aprender é com um exemplo, vamos para ele.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">O <a class="reference external" href="https://github.com/symfony/Security">componente de segurança</a> do Symfony está disponível como uma biblioteca
PHP podendo ser utilizada em qualquer projeto PHP.</p>
</div>
<div class="section" id="exemplo-autenticacao-basica-http">
<h2>Exemplo: Autenticação Básica HTTP<a class="headerlink" href="#exemplo-autenticacao-basica-http" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>O componente de segurança pode ser configurado através da configuração de</dt>
<dd>sua aplicação. Na verdade, a maioria dos esquemas comuns de segurança podem
ser conseguidos apenas configurando adequadamente sua aplicação. A configuração
a seguir diz ao Symfony para proteger qualquer URL que satisfaça <tt class="docutils literal"><span class="pre">/admin/*</span></tt>
através da autenticação básica HTTP, solicitando do usuário credenciais (login/senha).</dd>
</dl>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/security.yml</span>
<span class="l-Scalar-Plain">security</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">firewalls</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">secured_area</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">pattern</span><span class="p-Indicator">:</span>    <span class="l-Scalar-Plain">^/</span>
            <span class="l-Scalar-Plain">anonymous</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">~</span>
            <span class="l-Scalar-Plain">http_basic</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">realm</span><span class="p-Indicator">:</span> <span class="s">&quot;Secured</span><span class="nv"> </span><span class="s">Demo</span><span class="nv"> </span><span class="s">Area&quot;</span>

    <span class="l-Scalar-Plain">access_control</span><span class="p-Indicator">:</span>
        <span class="p-Indicator">-</span> <span class="p-Indicator">{</span> <span class="nv">path</span><span class="p-Indicator">:</span> <span class="nv">^/admin</span><span class="p-Indicator">,</span> <span class="nv">roles</span><span class="p-Indicator">:</span> <span class="nv">ROLE_ADMIN</span> <span class="p-Indicator">}</span>

    <span class="l-Scalar-Plain">providers</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">in_memory</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">users</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">ryan</span><span class="p-Indicator">:</span>  <span class="p-Indicator">{</span> <span class="nv">password</span><span class="p-Indicator">:</span> <span class="nv">ryanpass</span><span class="p-Indicator">,</span> <span class="nv">roles</span><span class="p-Indicator">:</span> <span class="s">&#39;ROLE_USER&#39;</span> <span class="p-Indicator">}</span>
                <span class="l-Scalar-Plain">admin</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span> <span class="nv">password</span><span class="p-Indicator">:</span> <span class="nv">kitten</span><span class="p-Indicator">,</span> <span class="nv">roles</span><span class="p-Indicator">:</span> <span class="s">&#39;ROLE_ADMIN&#39;</span> <span class="p-Indicator">}</span>

    <span class="l-Scalar-Plain">encoders</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">Symfony\Component\Security\Core\User\User</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">plaintext</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/security.xml --&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="nt">&lt;firewall</span> <span class="na">name=</span><span class="s">&quot;secured_area&quot;</span> <span class="na">pattern=</span><span class="s">&quot;^/&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;anonymous</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;http-basic</span> <span class="na">realm=</span><span class="s">&quot;Secured Demo Area&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/firewall&gt;</span>

        <span class="nt">&lt;access-control&gt;</span>
            <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/admin&quot;</span> <span class="na">role=</span><span class="s">&quot;ROLE_ADMIN&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/access-control&gt;</span>

        <span class="nt">&lt;provider</span> <span class="na">name=</span><span class="s">&quot;in_memory&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;user</span> <span class="na">name=</span><span class="s">&quot;ryan&quot;</span> <span class="na">password=</span><span class="s">&quot;ryanpass&quot;</span> <span class="na">roles=</span><span class="s">&quot;ROLE_USER&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;user</span> <span class="na">name=</span><span class="s">&quot;admin&quot;</span> <span class="na">password=</span><span class="s">&quot;kitten&quot;</span> <span class="na">roles=</span><span class="s">&quot;ROLE_ADMIN&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/provider&gt;</span>

        <span class="nt">&lt;encoder</span> <span class="na">class=</span><span class="s">&quot;Symfony\Component\Security\Core\User\User&quot;</span> <span class="na">algorithm=</span><span class="s">&quot;plaintext&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// app/config/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;firewalls&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;secured_area&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;pattern&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/&#39;</span><span class="p">,</span>
            <span class="s1">&#39;anonymous&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(),</span>
            <span class="s1">&#39;http_basic&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;realm&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Secured Demo Area&#39;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">),</span>
    <span class="p">),</span>
    <span class="s1">&#39;access_control&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/admin&#39;</span><span class="p">,</span> <span class="s1">&#39;role&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="s1">&#39;providers&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;in_memory&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;users&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;ryan&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ryanpass&#39;</span><span class="p">,</span> <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_USER&#39;</span><span class="p">),</span>
                <span class="s1">&#39;admin&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;kitten&#39;</span><span class="p">,</span> <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">),</span>
            <span class="p">),</span>
        <span class="p">),</span>
    <span class="p">),</span>
    <span class="s1">&#39;encoders&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;Symfony\Component\Security\Core\User\User&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;plaintext&#39;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">A distribuição padrão do Symfony coloca a configuração de segurança em
um arquivo separado (e.g. <tt class="docutils literal"><span class="pre">app/config/security.yml</span></tt>). Se você não
tem um arquivo separado para as configurações de segurança, pode colocar
diretamente no arquivo de configuração principal (por exemplo, <tt class="docutils literal"><span class="pre">app/config/config.yml</span></tt>).</p>
</div>
<p>O resultado final desta configuração é um completo sistema de segurança funcional
com as seguintes características:</p>
<ul class="simple">
<li>Há dois usuários no sistema (<tt class="docutils literal"><span class="pre">ryan</span></tt> e <tt class="docutils literal"><span class="pre">admin</span></tt>);</li>
<li>Os usuários se autenticam através da janela de autenticação básica HTTP;</li>
<li>Qualquer URL que comece com <tt class="docutils literal"><span class="pre">/admin/*</span></tt> será protegida e somente o usuário <tt class="docutils literal"><span class="pre">admin</span></tt>
terá acesso;</li>
<li>Todas URLs que <em>não</em> comecem com <tt class="docutils literal"><span class="pre">/admin/*</span></tt> são acessíveis a todos usuários
(e ao usuário nunca serão solicitadas as credenciais de acesso).</li>
</ul>
<p>Vamos dar uma olhada como funciona a segurança e como cada parte da configuração influencia
no sistema.</p>
</div>
<div class="section" id="como-funciona-a-seguranca-autenticacao-e-autorizacao">
<h2>Como funciona a segurança: Autenticação e Autorização<a class="headerlink" href="#como-funciona-a-seguranca-autenticacao-e-autorizacao" title="Permalink to this headline">¶</a></h2>
<p>O sistema de segurança do Symfony funciona determinando quem um usuário é (autenticação)
e depois checando se o usuário tem acesso ao recurso específico ou URL solicitado.</p>
<div class="section" id="firewalls-autenticacao">
<h3>Firewalls (Autenticação)<a class="headerlink" href="#firewalls-autenticacao" title="Permalink to this headline">¶</a></h3>
<p>Quando um usuário requisita uma URL que está protegida por um firewall,
o sistema de segurança é ativado. O trabalho do firewall é determinar
se o usuário precisa ou não ser autenticado. Se ele precisar, envia a resposta
de volta e inicia o processo de autenticação.</p>
<p>Um firewall será ativado quando a URL requisitada corresponda ao <tt class="docutils literal"><span class="pre">padrão</span> <span class="pre">de</span> <span class="pre">caracteres</span></tt> da
expressão regular configurada na configuração de segurança. Neste exemplo, o
<tt class="docutils literal"><span class="pre">padrão</span> <span class="pre">de</span> <span class="pre">caracteres</span></tt> (<tt class="docutils literal"><span class="pre">^/</span></tt>) corresponde a qualquer solicitação. O fato do
firewall ser ativado <em>não</em> significa, porém, que a janela de autenticação básica HTTP
(solicitando login e senha) será exibida para todas requisições. Por exemplo,
qualquer usuário poderá acessar <tt class="docutils literal"><span class="pre">/foo</span></tt> sem que seja solicitada sua autenticação.</p>
<img alt="../_images/security_anonymous_user_access.png" class="align-center" src="../_images/security_anonymous_user_access.png" />
<p>Isto funciona primeiramente por que o firewall permite <em>usuários anônimos</em> através
do parâmetro <tt class="docutils literal"><span class="pre">anonymous</span></tt> da configuração. Em outras palavras,  o firewall não
exige que o usuário se autentique completamente. E por que nenhum <tt class="docutils literal"><span class="pre">perfil</span></tt> (<tt class="docutils literal"><span class="pre">role</span></tt>)
é necessário para acessar <tt class="docutils literal"><span class="pre">/foo</span></tt> (na seção <tt class="docutils literal"><span class="pre">access_control</span></tt>), a solicitação
pode ser realizada sem que o usuário sequer se identifique.</p>
<p>Se você remover a chave <tt class="docutils literal"><span class="pre">anonymous</span></tt>, o firewall <em>sempre</em> fará o usuário se identificar
por completo imediatamente.</p>
</div>
<div class="section" id="controles-de-acesso-autorizacao">
<h3>Controles de acesso (Autorização)<a class="headerlink" href="#controles-de-acesso-autorizacao" title="Permalink to this headline">¶</a></h3>
<p>Se o usuário solicitar <tt class="docutils literal"><span class="pre">/admin/foo</span></tt>, porém, o processo toma um rumo diferente.
Isto acontecerá por que a seção <tt class="docutils literal"><span class="pre">access_control</span></tt> da configuração indica
que qualquer URL que se encaixe no padrão de caracteres <tt class="docutils literal"><span class="pre">^/admin</span></tt> (isto é, <tt class="docutils literal"><span class="pre">/admin</span></tt>
ou qualquer coisa do tipo <tt class="docutils literal"><span class="pre">/admin/*</span></tt>) deve ser acessada somente por usuários
com o perfil <tt class="docutils literal"><span class="pre">ROLE_ADMIN</span></tt>. Perfis são a base para a maioria das autorizações:
o usuário pode acessar <tt class="docutils literal"><span class="pre">/admin/foo</span></tt> somente se tiver o perfil <tt class="docutils literal"><span class="pre">ROLE_ADMIN</span></tt>.</p>
<img alt="../_images/security_anonymous_user_denied_authorization.png" class="align-center" src="../_images/security_anonymous_user_denied_authorization.png" />
<p>Como antes, o firewall não solicita credenciais de acesso. Assim que a camada
de controle de acesso nega o acesso (por que o usuário não tem o perfil <tt class="docutils literal"><span class="pre">ROLE_ADMIN</span></tt>),
porém, o firewall inicia o processo de autenticação. Este processo depende
do mecanismo de autenticação que estiver utilizando. Por exemplo, se estiver utilizando
o método de formulário de autenticação (<tt class="docutils literal"><span class="pre">form</span> <span class="pre">login</span></tt>), o usuário será redirecionado
para a página de login. Se estiver utilizando o método básico de autenticação HTTP,
o navegador recebe uma resposta do tipo HTTP 401 para que ao usuário seja exibida
a janela de login/senha do navegador.</p>
<p>O usuário agora tem a oportunidade de digitar suas credenciais no aplicativo. Se as
credenciais forem válidas, a requisição original será solicitada novamente.</p>
<img alt="../_images/security_ryan_no_role_admin_access.png" class="align-center" src="../_images/security_ryan_no_role_admin_access.png" />
<p>No exemplo, o usuário <tt class="docutils literal"><span class="pre">ryan</span></tt> se autentica com sucesso pelo firewall. Como, porém,
<tt class="docutils literal"><span class="pre">ryan</span></tt> não tem o perfil <tt class="docutils literal"><span class="pre">ROLE_ADMIN</span></tt>, ele ainda terá seu acesso negado ao
recurso <tt class="docutils literal"><span class="pre">/admin/foo</span></tt>. Infelizmente, isto significa que o usuário verá
uma mensagem indicando que o acesso foi negado.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Quando o Symfony nega acesso a um usuário, o usuário vê uma tela de
erro e o navegador recebe uma resposta com o HTTP status code 403 (<tt class="docutils literal"><span class="pre">Forbidden</span></tt>).
É possível personalizar a tela de erro de acesso negado seguindo as
instruções em <em class="xref std std-ref">Error Pages</em> do
do texto do Symfony 2 - Passo-a-passo que ensina a personalizar a página
de erro 403.</p>
</div>
<p>Finalmente, se o usuário <tt class="docutils literal"><span class="pre">admin</span></tt> requisitar <tt class="docutils literal"><span class="pre">/admin/foo</span></tt>, um processo similar
entra em ação, mas neste caso, após a autenticação, a camada de controle de acesso
permitirá que a requisição seja completada:</p>
<img alt="../_images/security_admin_role_access.png" class="align-center" src="../_images/security_admin_role_access.png" />
<p>O fluxo de requisição quando um usuário solicita um recurso protegido é direto,
mas muito flexível. Como verá mais tarde, a autenticação pode acontecer de
diversas maneiras, incluindo formulário de login, certificado X.509, ou
autenticação pelo Twitter. Independente do método de autenticação, o fluxo
de requisiçao é sempre o mesmo:</p>
<ol class="arabic simple">
<li>Um usuário acessa um recurso protegido;</li>
<li>O aplicativo redireciona o usuário para o formulário de login;</li>
<li>O usuário envia suas credenciais (e.g. login/senha);</li>
<li>O firewall autentica o usuário;</li>
<li>O usuário autenticado é redirecionado para o recurso solicitado originalmente.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>O processo <em>exato</em> na verdade depende um pouco do mecanismo de autenticação
que estiver usando. Por exemplo, quando estiver utilizando formulário de login,
o usuário envia suas credenciais para a URL que processa o formulário (por exemplo,
<tt class="docutils literal"><span class="pre">/login_check</span></tt>) e depois é redirecionado de volta para a URL solicitada
originalmente (por exemplo, <tt class="docutils literal"><span class="pre">/admin/foo</span></tt>). Se utilizar autenticação básica
HTTP, porém, o usuário envia suas credenciais diretamente para a URL original
(por exemplo, <tt class="docutils literal"><span class="pre">/admin/foo</span></tt>) e depois a página é retornada para o usuário
na mesma requisição (isto significa que não há redirecionamentos).</p>
<p class="last">Estes detalhes técnicos não devem ser relevantes no uso do sistema de
segurança, mas é bom ter uma idéia a respeito.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Você aprenderá mais tarde como <em>qualquer coisa</em> pode ser protegida no Symfony2,
incluindo controladores específicos, objetos, ou até métodos PHP.</p>
</div>
</div>
</div>
<div class="section" id="usando-um-formulario-de-login-em-html">
<span id="book-security-form-login"></span><h2>Usando um formulário de login em HTML<a class="headerlink" href="#usando-um-formulario-de-login-em-html" title="Permalink to this headline">¶</a></h2>
<p>Até agora, você viu como cobrir seu aplicativo depois do firewall e assim
restringir o acesso de certas áreas a certos perfis. Utilizando a autenticação
básica HTTP, é possível, sem esforços, submeter login/senha através da
janela do navegador. O Symfony, porém, suporta de fábrica muitos outros
mecanismos de autenticação. Para detalhes sobre todos eles, consulte
<tt class="xref doc docutils literal"><span class="pre">Referência</span> <span class="pre">Da</span> <span class="pre">Configuração</span> <span class="pre">De</span> <span class="pre">Segurança</span></tt>.</p>
<p>Nesta seção, você aprimorará o processo permitindo que o usuário se autentique através
de um formulário de login tradicional em HTML.</p>
<p>Primeiro habilite o formulário no seu firewall:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/security.yml</span>
<span class="l-Scalar-Plain">security</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">firewalls</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">secured_area</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">pattern</span><span class="p-Indicator">:</span>    <span class="l-Scalar-Plain">^/</span>
            <span class="l-Scalar-Plain">anonymous</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">~</span>
            <span class="l-Scalar-Plain">form_login</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">login_path</span><span class="p-Indicator">:</span>  <span class="l-Scalar-Plain">/login</span>
                <span class="l-Scalar-Plain">check_path</span><span class="p-Indicator">:</span>  <span class="l-Scalar-Plain">/login_check</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/security.xml --&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="nt">&lt;firewall</span> <span class="na">name=</span><span class="s">&quot;secured_area&quot;</span> <span class="na">pattern=</span><span class="s">&quot;^/&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;anonymous</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;form-login</span> <span class="na">login_path=</span><span class="s">&quot;/login&quot;</span> <span class="na">check_path=</span><span class="s">&quot;/login_check&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/firewall&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// app/config/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;firewalls&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;secured_area&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;pattern&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/&#39;</span><span class="p">,</span>
            <span class="s1">&#39;anonymous&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(),</span>
            <span class="s1">&#39;form_login&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;login_path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/login&#39;</span><span class="p">,</span>
                <span class="s1">&#39;check_path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/login_check&#39;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">),</span>
    <span class="p">),</span>
<span class="p">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Se não precisar de personlizar os valores de <tt class="docutils literal"><span class="pre">login_path</span></tt> ou <tt class="docutils literal"><span class="pre">check_path</span></tt>
(os valores utilizados acima são os valores padrão), você pode encurtar
seu configuração:</p>
<div class="last configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">form_login</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">~</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;form-login</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="s1">&#39;form_login&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(),</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<p>Agora, quando o sistema de segurança inicia o processo de autenticação,
ele redirecionará o usuário para o formulário de login (<tt class="docutils literal"><span class="pre">/login</span></tt> por padrão).
É sua tarefa implementar o visual desse formulário. Primeiro, crie duas rotas:
uma para a exibição do formulário de login (no caso, <tt class="docutils literal"><span class="pre">/login</span></tt>) e outra
para processar a submissão do formulário (no caso, <tt class="docutils literal"><span class="pre">/login_check</span></tt>):</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/routing.yml</span>
<span class="l-Scalar-Plain">login</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">pattern</span><span class="p-Indicator">:</span>   <span class="l-Scalar-Plain">/login</span>
    <span class="l-Scalar-Plain">defaults</span><span class="p-Indicator">:</span>  <span class="p-Indicator">{</span> <span class="nv">_controller</span><span class="p-Indicator">:</span> <span class="nv">AcmeSecurityBundle</span><span class="p-Indicator">:</span><span class="nv">Security</span><span class="p-Indicator">:</span><span class="nv">login</span> <span class="p-Indicator">}</span>
<span class="l-Scalar-Plain">login_check</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">pattern</span><span class="p-Indicator">:</span>   <span class="l-Scalar-Plain">/login_check</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/routing.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>

<span class="nt">&lt;routes</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/routing&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/routing http://symfony.com/schema/routing/routing-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;route</span> <span class="na">id=</span><span class="s">&quot;login&quot;</span> <span class="na">pattern=</span><span class="s">&quot;/login&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;default</span> <span class="na">key=</span><span class="s">&quot;_controller&quot;</span><span class="nt">&gt;</span>AcmeSecurityBundle:Security:login<span class="nt">&lt;/default&gt;</span>
    <span class="nt">&lt;/route&gt;</span>
    <span class="nt">&lt;route</span> <span class="na">id=</span><span class="s">&quot;login_check&quot;</span> <span class="na">pattern=</span><span class="s">&quot;/login_check&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/routes&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// app/config/routing.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\RouteCollection</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Route</span><span class="p">;</span>

<span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RouteCollection</span><span class="p">();</span>
<span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;_controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;AcmeDemoBundle:Security:login&#39;</span><span class="p">,</span>
<span class="p">)));</span>
<span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;login_check&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Route</span><span class="p">(</span><span class="s1">&#39;/login_check&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">()));</span>

<span class="k">return</span> <span class="nv">$collection</span><span class="p">;</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><em>Não</em> é preciso implementar o controller para a URL <tt class="docutils literal"><span class="pre">/login_check</span></tt>
pois o firewall interceptará e processará o que foi submitido para essa URL.
É opcional, porém útil, criar uma rota para que você possa gerar o link
de submissão na template do formulário de login.</p>
</div>
<p>Observe que o nome da rota <tt class="docutils literal"><span class="pre">login</span></tt> não é importante. O que importa é que a
URL da rota corresponda o que foi colocado na configuração  <tt class="docutils literal"><span class="pre">login_path</span></tt>, pois
é para onde o sistema de segurança redirecionará os usuários que precisarem
se autenticar.</p>
<p>O próximo passo é criar o controller que exibirá o formulário de login:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Acme/SecurityBundle/Controller/Main;</span>
<span class="k">namespace</span> <span class="nx">Acme\SecurityBundle\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Security\Core\SecurityContext</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SecurityController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">loginAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$request</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getRequest</span><span class="p">();</span>
        <span class="nv">$session</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getSession</span><span class="p">();</span>

        <span class="c1">// get the login error if there is one</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">attributes</span><span class="o">-&gt;</span><span class="na">has</span><span class="p">(</span><span class="nx">SecurityContext</span><span class="o">::</span><span class="na">AUTHENTICATION_ERROR</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$error</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">attributes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nx">SecurityContext</span><span class="o">::</span><span class="na">AUTHENTICATION_ERROR</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$error</span> <span class="o">=</span> <span class="nv">$session</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nx">SecurityContext</span><span class="o">::</span><span class="na">AUTHENTICATION_ERROR</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;AcmeSecurityBundle:Security:login.html.twig&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="c1">// last username entered by the user</span>
            <span class="s1">&#39;last_username&#39;</span> <span class="o">=&gt;</span> <span class="nv">$session</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nx">SecurityContext</span><span class="o">::</span><span class="na">LAST_USERNAME</span><span class="p">),</span>
            <span class="s1">&#39;error&#39;</span>         <span class="o">=&gt;</span> <span class="nv">$error</span><span class="p">,</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Não se confunda com esse controller. Como verá, quando o usuário submete o formulário,
o sistema de segurança automaticamente processar a submissão para você. Se o usuário
entrou com login e/ou senha inválidos, este controller pega o erro ocorrido do sistema
de segurança para poder exibir ao usuário.</p>
<p>Em outras palavras, seu trabalho é exibir o formulário de login e qualquer
erro ocorrido durante a tentativa de autenticação, mas o sistema de segurança
já toma conta de checar se as credenciais são válidas e de autenticar o usuário.</p>
<p>Finalmente crie a template correspondente:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>Twig</em><div class="highlight-html+jinja"><div class="highlight"><pre><span class="c">{# src/Acme/SecurityBundle/Resources/views/Security/login.html.twig #}</span>
<span class="cp">{%</span> <span class="k">if</span> <span class="nv">error</span> <span class="cp">%}</span>
    <span class="nt">&lt;div&gt;</span><span class="cp">{{</span> <span class="nv">error.message</span> <span class="cp">}}</span><span class="nt">&lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">path</span><span class="o">(</span><span class="s1">&#39;login_check&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;username&quot;</span><span class="nt">&gt;</span>Username:<span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">id=</span><span class="s">&quot;username&quot;</span> <span class="na">name=</span><span class="s">&quot;_username&quot;</span> <span class="na">value=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">last_username</span> <span class="cp">}}</span><span class="s">&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;password&quot;</span><span class="nt">&gt;</span>Password:<span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;password&quot;</span> <span class="na">id=</span><span class="s">&quot;password&quot;</span> <span class="na">name=</span><span class="s">&quot;_password&quot;</span> <span class="nt">/&gt;</span>

    <span class="c">{#</span>
<span class="c">        If you want to control the URL the user is redirected to on success (more details below)</span>
<span class="c">        &lt;input type=&quot;hidden&quot; name=&quot;_target_path&quot; value=&quot;/account&quot; /&gt;</span>
<span class="c">    #}</span>

    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;login&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span> <span class="c1">// src/Acme/SecurityBundle/Resources/views/Security/login.html.php ?&gt;</span>
<span class="o">&lt;?</span><span class="nx">php</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$error</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;div&gt;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$error</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">()</span> <span class="cp">?&gt;</span><span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;?php</span> <span class="k">endif</span><span class="p">;</span> <span class="cp">?&gt;</span>

<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">&#39;router&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">generate</span><span class="p">(</span><span class="s1">&#39;login_check&#39;</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="s">&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;username&quot;</span><span class="nt">&gt;</span>Username:<span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">id=</span><span class="s">&quot;username&quot;</span> <span class="na">name=</span><span class="s">&quot;_username&quot;</span> <span class="na">value=</span><span class="s">&quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$last_username</span> <span class="cp">?&gt;</span><span class="s">&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;password&quot;</span><span class="nt">&gt;</span>Password:<span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;password&quot;</span> <span class="na">id=</span><span class="s">&quot;password&quot;</span> <span class="na">name=</span><span class="s">&quot;_password&quot;</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!--</span>
<span class="c">        If you want to control the URL the user is redirected to on success (more details below)</span>
<span class="c">        &lt;input type=&quot;hidden&quot; name=&quot;_target_path&quot; value=&quot;/account&quot; /&gt;</span>
<span class="c">    --&gt;</span>

    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;login&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">A variável <tt class="docutils literal"><span class="pre">error</span></tt> passada para a template é uma instância de
<tt class="docutils literal"><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Security/Core/Exception/AuthenticationException.html" title="Symfony\Component\Security\Core\Exception\AuthenticationException"><span class="pre">AuthenticationException</span></a></tt>.
Esta pode conter mais informações - ou até informações sensíveis - sobre a
falha na autenticação, por isso use-a com sabedoria!</p>
</div>
<p>O formulário tem que atender alguns requisitos. Primeiro, ao submeter o formulário
para <tt class="docutils literal"><span class="pre">/login_check</span></tt> (através da rota  <tt class="docutils literal"><span class="pre">login_check</span></tt>), o sistema de segurança
interceptará a submissão do formulário e o processará. Segundo, o sistema de segurança
espera que os campos submetidos sejam chamados <tt class="docutils literal"><span class="pre">_username</span></tt> e <tt class="docutils literal"><span class="pre">_password</span></tt>
(estes nomes podem ser <em class="xref std std-ref">configured</em>).</p>
<p>E é isso! Quando submeter um formulário, o sistema de segurança irá automaticamente
checar as credenciais do usuário e autenticá-lo ou enviar o ele de volta ao
formulário de login para o erro ser exibido.</p>
<p>Vamos revisar o processo inteiro:</p>
<ol class="arabic simple">
<li>O usuário tenta acessar um recurso que está protegido;</li>
<li>O firewall inicia o processo de autenticação redirecionando o
usuário para o formulário de login(<tt class="docutils literal"><span class="pre">/login</span></tt>);</li>
<li>A página <tt class="docutils literal"><span class="pre">/login</span></tt> produz o formulário de login através da rota
e controlador criados neste exemplo;</li>
<li>O usuário submete o formulário de login para <tt class="docutils literal"><span class="pre">/login_check</span></tt>;</li>
<li>O sistema de segurança intercepta a solicitação, verifica as credenciais
submetidas pelo usuário, autentica o mesmo se tiverem corretas ou envia
de volta para o formulário de login caso contrário;</li>
</ol>
<p>Por padrão, se as credenciais estiverem corretas, o usuário será redirecionado
para a página que solicitou originalmente (e.g. <tt class="docutils literal"><span class="pre">/admin/foo</span></tt>). Se o usuário
originalmente solicitar a página de login, ele será redirecionado para a página
principal. Isto pode ser modificado se necessário, o que permitiria você
redirecionar o usuário para um outra URL específica.</p>
<p>Para maiores detalhes sobre isso e como personalizar o processamento do
formulário de login acesse
<a class="reference internal" href="../cookbook/security/form_login.html"><em>Como personalizar o seu Formulário de Login</em></a>.</p>
<div class="sidebar" id="book-security-common-pitfalls">
<p class="first sidebar-title">Evite os erros comuns</p>
<p>Quando estiver configurando seu formulário de login, fique atendo
aos seguintes erros comuns.</p>
<p><strong>1. Crie as rotas corretas</strong></p>
<p>Primeiro, tenha certeza que definiu as rotas <tt class="docutils literal"><span class="pre">/login</span></tt> e <tt class="docutils literal"><span class="pre">/login_check</span></tt>
corretamente e que elas correspondem aos calores das configurações
<tt class="docutils literal"><span class="pre">login_path</span></tt> e <tt class="docutils literal"><span class="pre">check_path</span></tt>. A configuração errada pode significar que
você será redirecionado para a página de erro 404 ao invés da página
de login ou a submissão do formulário de login não faça nada (você
sempre vê o formulário sem sair dele).</p>
<p><strong>2. Tenha certeza que a página de login não é protegida</strong></p>
<p>Também tenha certeza que a página de login <em>não</em> precisa de qualquer
perfil para ser vizualizada. Por exemplo, a seguinte configuração,
que exige o perfil <tt class="docutils literal"><span class="pre">ROLE_ADMIN</span></tt> para todas as URLs (incluindo a
URL <tt class="docutils literal"><span class="pre">/login</span></tt>), causará um redirecionamento circular:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">access_control</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="p-Indicator">{</span> <span class="nv">path</span><span class="p-Indicator">:</span> <span class="nv">^/</span><span class="p-Indicator">,</span> <span class="nv">roles</span><span class="p-Indicator">:</span> <span class="nv">ROLE_ADMIN</span> <span class="p-Indicator">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;access-control&gt;</span>
    <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/&quot;</span> <span class="na">role=</span><span class="s">&quot;ROLE_ADMIN&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/access-control&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="s1">&#39;access_control&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/&#39;</span><span class="p">,</span> <span class="s1">&#39;role&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">),</span>
<span class="p">),</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>Removendo o controle de acesso para a URL <tt class="docutils literal"><span class="pre">/login</span></tt> resolve o problema:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">access_control</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="p-Indicator">{</span> <span class="nv">path</span><span class="p-Indicator">:</span> <span class="nv">^/login</span><span class="p-Indicator">,</span> <span class="nv">roles</span><span class="p-Indicator">:</span> <span class="nv">IS_AUTHENTICATED_ANONYMOUSLY</span> <span class="p-Indicator">}</span>
    <span class="p-Indicator">-</span> <span class="p-Indicator">{</span> <span class="nv">path</span><span class="p-Indicator">:</span> <span class="nv">^/</span><span class="p-Indicator">,</span> <span class="nv">roles</span><span class="p-Indicator">:</span> <span class="nv">ROLE_ADMIN</span> <span class="p-Indicator">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;access-control&gt;</span>
    <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/login&quot;</span> <span class="na">role=</span><span class="s">&quot;IS_AUTHENTICATED_ANONYMOUSLY&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/&quot;</span> <span class="na">role=</span><span class="s">&quot;ROLE_ADMIN&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/access-control&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="s1">&#39;access_control&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/login&#39;</span><span class="p">,</span> <span class="s1">&#39;role&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;IS_AUTHENTICATED_ANONYMOUSLY&#39;</span><span class="p">),</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/&#39;</span><span class="p">,</span> <span class="s1">&#39;role&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">),</span>
<span class="p">),</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>Além disso, se o seu firewall <em>não</em> permite usuários anônimos, você precisará
criar um firewall especial para permitir usuários anônimos para a página de login:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">firewalls</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">login_firewall</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">pattern</span><span class="p-Indicator">:</span>    <span class="l-Scalar-Plain">^/login$</span>
        <span class="l-Scalar-Plain">anonymous</span><span class="p-Indicator">:</span>  <span class="l-Scalar-Plain">~</span>
    <span class="l-Scalar-Plain">secured_area</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">pattern</span><span class="p-Indicator">:</span>    <span class="l-Scalar-Plain">^/</span>
        <span class="l-Scalar-Plain">form_login</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">~</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;firewall</span> <span class="na">name=</span><span class="s">&quot;login_firewall&quot;</span> <span class="na">pattern=</span><span class="s">&quot;^/login$&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;anonymous</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/firewall&gt;</span>
<span class="nt">&lt;firewall</span> <span class="na">name=</span><span class="s">&quot;secured_area&quot;</span> <span class="na">pattern=</span><span class="s">&quot;^/&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;form_login</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/firewall&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="s1">&#39;firewalls&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;login_firewall&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;pattern&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/login$&#39;</span><span class="p">,</span>
        <span class="s1">&#39;anonymous&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(),</span>
    <span class="p">),</span>
    <span class="s1">&#39;secured_area&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;pattern&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/&#39;</span><span class="p">,</span>
        <span class="s1">&#39;form_login&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(),</span>
    <span class="p">),</span>
<span class="p">),</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p><strong>3. Tenha certeza que ``/login_check`` está protegida por um firewall</strong></p>
<p>Certifique-se que a URL indicada em <tt class="docutils literal"><span class="pre">check_path</span></tt> (no caso, <tt class="docutils literal"><span class="pre">/login_check</span></tt>)
esteja protegida por um firewall que está utilizando seu formulário de login
(neste exemplo, um único firewall filtra <em>todas</em> as URLs, incluindo <tt class="docutils literal"><span class="pre">/login_check</span></tt>).
Se <tt class="docutils literal"><span class="pre">/login_check</span></tt> não estiver atrás de nenhum firewall, uma exceção
será gerada <tt class="docutils literal"><span class="pre">Unable</span> <span class="pre">to</span> <span class="pre">find</span> <span class="pre">the</span> <span class="pre">controller</span> <span class="pre">for</span> <span class="pre">path</span> <span class="pre">&quot;/login_check&quot;</span></tt>.</p>
<p><strong>4. Múltiplos firewalls não compartilham o mesmo contexto de segurança</strong></p>
<p class="last">Se estiver utilizando múltiplos firewalls e se autenticar em um firewall,
você <em>não</em> estará autenticado nos outros firewalls automaticamente.
Firewalls diferentes funcionam como sistemas de segurança diferente. Isto
acontece por que para a maioria dos aplicativos ter somente um
firewall é o suficiente.</p>
</div>
</div>
<div class="section" id="autorizacao">
<h2>Autorização<a class="headerlink" href="#autorizacao" title="Permalink to this headline">¶</a></h2>
<p>O primeiro passo na segurança é sempre a autenticação: o processo de verficar quem
o usuário é. No Symfony, a autenticação pode ser feita de várias maneiras -  via
formulário de login, autenticação básica HTTP ou até mesmo pelo Facebook.</p>
<p>Uma vez que o usuário está autenticado, a autorização começa. Autorização fornece
uma maneira padrão e poderosa de decidir se o usuário pode acessar algum recurso
(uma  URL, um objeto do modelo, um método...). Isto funciona com perfis atribuídos
para cada usuário e exigindo perfis diferentes para diferentes recursos.</p>
<p>O processo de autorização tem dois lados diferentes:</p>
<ol class="arabic simple">
<li>O usuário tem um conjunto de perfis específico;</li>
<li>Um recurso requer um perfil específico para ser acessado.</li>
</ol>
<p>Nesta seção, o foco será em como tornar seguros diferentes recursos (por exemplo URLs,
chamadas a métodos, etc) com diferentes perfis. Mais tarde, você aprenderá mais
como perfis são criados e atribuídos aos usuários.</p>
<div class="section" id="protegendo-padroes-de-urls">
<h3>Protegendo padrões de URLs<a class="headerlink" href="#protegendo-padroes-de-urls" title="Permalink to this headline">¶</a></h3>
<p>A maneira mais básica de proteger seu aplicativo é proteger um padrão de URL.
Você já viu no primeiro exemplo deste capítulo que qualquer requisição que
se encaixasse na expressão regular <tt class="docutils literal"><span class="pre">^/admin</span></tt> exigiria o perfil <tt class="docutils literal"><span class="pre">ROLE_ADMIN</span></tt>.</p>
<p>Você pode definir quantos padrões precisar. Cada um é uma expressão regular.</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/config.yml</span>
<span class="l-Scalar-Plain">security</span><span class="p-Indicator">:</span>
    <span class="c1"># ...</span>
    <span class="l-Scalar-Plain">access_control</span><span class="p-Indicator">:</span>
        <span class="p-Indicator">-</span> <span class="p-Indicator">{</span> <span class="nv">path</span><span class="p-Indicator">:</span> <span class="nv">^/admin/users</span><span class="p-Indicator">,</span> <span class="nv">roles</span><span class="p-Indicator">:</span> <span class="nv">ROLE_SUPER_ADMIN</span> <span class="p-Indicator">}</span>
        <span class="p-Indicator">-</span> <span class="p-Indicator">{</span> <span class="nv">path</span><span class="p-Indicator">:</span> <span class="nv">^/admin</span><span class="p-Indicator">,</span> <span class="nv">roles</span><span class="p-Indicator">:</span> <span class="nv">ROLE_ADMIN</span> <span class="p-Indicator">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/config.xml --&gt;</span>
<span class="nt">&lt;config&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
    <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/admin/users&quot;</span> <span class="na">role=</span><span class="s">&quot;ROLE_SUPER_ADMIN&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/admin&quot;</span> <span class="na">role=</span><span class="s">&quot;ROLE_ADMIN&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/config&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// app/config/config.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="c1">// ...</span>
    <span class="s1">&#39;access_control&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/admin/users&#39;</span><span class="p">,</span> <span class="s1">&#39;role&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_SUPER_ADMIN&#39;</span><span class="p">),</span>
        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/admin&#39;</span><span class="p">,</span> <span class="s1">&#39;role&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">),</span>
    <span class="p">),</span>
<span class="p">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Iniciando o padrão com <tt class="docutils literal"><span class="pre">^</span></tt> garante que somente URLs <em>começando</em> com o padrão
terá uma comparação positiva. Por exemplo, o padrão simples <tt class="docutils literal"><span class="pre">/admin</span></tt> (sem
o <tt class="docutils literal"><span class="pre">^</span></tt>) resultaria em uma comparação positiva para <tt class="docutils literal"><span class="pre">/admin/foo</span></tt>, mas
também para URLs como <tt class="docutils literal"><span class="pre">/foo/admin</span></tt>.</p>
</div>
<p>Para cada requisição que chega, o Symfony2 tenta encontrar uma regra de acesso
correspondente, com comparação positiva do padrão (a primeira que encontrar ganha).
Se o usuário não estiver autenticado ainda, a autenticação é iniciada (isto é,
o usuário tem a chance de fazer login). Se o usuário, porém, já <em>estiver</em> autenticado,
mas não tiver o perfil exigido, uma exceção é disparada
<tt class="docutils literal"><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Security/Core/Exception/AccessDeniedException.html" title="Symfony\Component\Security\Core\Exception\AccessDeniedException"><span class="pre">AccessDeniedException</span></a></tt> ,
que você pode tratar e transformar em uma apresentável página de &#8220;Acesso Negado&#8221;
para o usuário. Veja <tt class="xref doc docutils literal"><span class="pre">/cookbook/controller/error_pages</span></tt> para mais informações.</p>
<p>Como o Symfony utiliza a primeira regra de acesso que der uma comparação positiva, uma
URL como <tt class="docutils literal"><span class="pre">/admin/users/new</span></tt> corresponderá a primeira regra e exigirá somente o perfil
<tt class="docutils literal"><span class="pre">ROLE_SUPER_ADMIN</span></tt>. Qualquer URL como <tt class="docutils literal"><span class="pre">/admin/blog</span></tt> corresponderá a segunda regra e
exigirá o perfil <tt class="docutils literal"><span class="pre">ROLE_ADMIN</span></tt>.</p>
</div>
<div class="section" id="protegendo-por-ip">
<span id="book-security-securing-ip"></span><h3>Protegendo por IP<a class="headerlink" href="#protegendo-por-ip" title="Permalink to this headline">¶</a></h3>
<p>Algumas situações podem exigir que você restrinja o acesso de uma determinada rota com base no IP.
Isto é particularmente relevante no caso de <a class="reference internal" href="http_cache.html#edge-side-includes"><em>Edge Side Includes</em></a> (ESI),
por exemplo, que utiliza a rota com nome &#8220;_internal&#8221;. Quanto ESI é utilizado, a rota
_internal é requerida pelo gateway cache (gerente de cache) para possibilitar diferentes
opções de caching para subseções dentro de uma determinada página. Esta rota vem com o
prefixo ^/_internal por padrão na edição padrão (assumindo que você ativou estas linhas
do seu arquivo de configuração de rotas - routing.yml).</p>
<p>Aqui está um exemplo de como poderia proteger esta rota de acesso externo:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/security.yml</span>
<span class="l-Scalar-Plain">security</span><span class="p-Indicator">:</span>
    <span class="c1"># ...</span>
    <span class="l-Scalar-Plain">access_control</span><span class="p-Indicator">:</span>
        <span class="p-Indicator">-</span> <span class="p-Indicator">{</span> <span class="nv">path</span><span class="p-Indicator">:</span> <span class="nv">^/_internal</span><span class="p-Indicator">,</span> <span class="nv">roles</span><span class="p-Indicator">:</span> <span class="nv">IS_AUTHENTICATED_ANONYMOUSLY</span><span class="p-Indicator">,</span> <span class="nv">ip</span><span class="p-Indicator">:</span> <span class="nv">127.0.0.1</span> <span class="p-Indicator">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;access-control&gt;</span>
    <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/_internal&quot;</span> <span class="na">role=</span><span class="s">&quot;IS_AUTHENTICATED_ANONYMOUSLY&quot;</span> <span class="na">ip=</span><span class="s">&quot;127.0.0.1&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/access-control&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="s1">&#39;access_control&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/_internal&#39;</span><span class="p">,</span> <span class="s1">&#39;role&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;IS_AUTHENTICATED_ANONYMOUSLY&#39;</span><span class="p">,</span> <span class="s1">&#39;ip&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">),</span>
<span class="p">),</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="protegendo-por-canal">
<span id="book-security-securing-channel"></span><h3>Protegendo por canal<a class="headerlink" href="#protegendo-por-canal" title="Permalink to this headline">¶</a></h3>
<p>Assim como a proteção por IP, exigir o uso de SSL é tão simples quanto adicionar uma
nova entrar em access_control:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/security.yml</span>
<span class="l-Scalar-Plain">security</span><span class="p-Indicator">:</span>
    <span class="c1"># ...</span>
    <span class="l-Scalar-Plain">access_control</span><span class="p-Indicator">:</span>
        <span class="p-Indicator">-</span> <span class="p-Indicator">{</span> <span class="nv">path</span><span class="p-Indicator">:</span> <span class="nv">^/cart/checkout</span><span class="p-Indicator">,</span> <span class="nv">roles</span><span class="p-Indicator">:</span> <span class="nv">IS_AUTHENTICATED_ANONYMOUSLY</span><span class="p-Indicator">,</span> <span class="nv">requires_channel</span><span class="p-Indicator">:</span> <span class="nv">https</span> <span class="p-Indicator">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;access-control&gt;</span>
    <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/cart/checkout&quot;</span> <span class="na">role=</span><span class="s">&quot;IS_AUTHENTICATED_ANONYMOUSLY&quot;</span> <span class="na">requires_channel=</span><span class="s">&quot;https&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/access-control&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="s1">&#39;access_control&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/cart/checkout&#39;</span><span class="p">,</span> <span class="s1">&#39;role&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;IS_AUTHENTICATED_ANONYMOUSLY&#39;</span><span class="p">,</span> <span class="s1">&#39;requires_channel&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;https&#39;</span><span class="p">),</span>
<span class="p">),</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="protegendo-um-controller">
<span id="book-security-securing-controller"></span><h3>Protegendo um Controller<a class="headerlink" href="#protegendo-um-controller" title="Permalink to this headline">¶</a></h3>
<p>Proteger seu aplicativo baseado em padrões de URL é fácil, mas este método pode não ser
específico o bastante em certos casos. Quando necessário, você pode ainda facilmente
forçar autorização de dentro de um controller:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">Symfony\Component\Security\Core\Exception\AccessDeniedException</span><span class="p">;</span>
<span class="c1">// ...</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">helloAction</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">false</span> <span class="o">===</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;security.context&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span><span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">AccessDeniedException</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p id="book-security-securing-controller-annotations">Você pode ainda instalar e utilizar opcionalmente o <tt class="docutils literal"><span class="pre">JMSSecurityExtraBundle</span></tt>,
que te permite proteger controllers através de anotações:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">JMS\SecurityExtraBundle\Annotation\Secure</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * @Secure(roles=&quot;ROLE_ADMIN&quot;)</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">helloAction</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Para mais informações, veja a documentação <a class="reference external" href="https://github.com/schmittjoh/JMSSecurityExtraBundle">JMSSecurityExtraBundle</a> . Se você
a distribuição Standard do Symfony, este bundle está habilitado por padrão.
Se não estiver, você pode facilmente baixar e instalá-lo.</p>
</div>
<div class="section" id="protegendo-outros-servicos">
<h3>Protegendo outros serviços<a class="headerlink" href="#protegendo-outros-servicos" title="Permalink to this headline">¶</a></h3>
<p>De fato, qualquer coisa pode ser protegida em Symfony utilizando uma estratégia
similar a apresentada na seção anterior. Por exemplo, suponha que você tem
um serviço (uma classe PHP, por exemplo) que seu trabalho é enviar e-mails
de um usuário para outro. Você pode restringir o uso dessa classe - não
importa de onde está sendo utilizada - a usuários que tenham um perfil específico.</p>
<p>Para mais informações sobre como você pode utilizar o componente de segurança
para proteger diferentes serviços e métodos de seu aplicativo, consulte <tt class="xref doc docutils literal"><span class="pre">/cookbook/security/securing_services</span></tt>.</p>
</div>
<div class="section" id="listas-de-controle-de-acesso-acls-protegendo-objetos-especificos-do-banco-de-dados">
<h3>Listas De Controle De Acesso (ACLs): Protegendo Objetos Específicos Do Banco De Dados<a class="headerlink" href="#listas-de-controle-de-acesso-acls-protegendo-objetos-especificos-do-banco-de-dados" title="Permalink to this headline">¶</a></h3>
<p>Imagine que você está projetando um sistema de blog onde seus usuários podem
comentar seus posts. Agora, você quer que um usuário tenha a possibilidade de editar
seus próprios comentários, mas não aqueles de outros usuários. Além disso, como
administrador, você quer poder editar <em>todos</em> os comentários.</p>
<p>O componente de segurança possui um sistema de listas de controle de acesso (ACL)
que te permite controlar acesso a instâncias individuais de um objeto no seu
sistema. <em>Sem</em> ACL, você consegue proteger seu sistema para que
somente usuários específicos possam editar os comentários. <em>Com</em> ACL, porém, você
pode restringir ou permitir o acesso por comentário.</p>
<p>Para mais informação, veja o passo-a-passo: <a class="reference internal" href="../cookbook/security/acl.html"><em>Listas de controle de acesso (ACLs)</em></a>.</p>
</div>
</div>
<div class="section" id="usuarios">
<h2>Usuários<a class="headerlink" href="#usuarios" title="Permalink to this headline">¶</a></h2>
<p>Nas seções anteriores, você aprendeu como proteger diferentes recursos exigindo
um conjunto de <em>perfis</em> para o acesso a um recurso. Nesta seção exploraremos
outro aspecto da autorização: os usuários.</p>
<div class="section" id="de-onde-os-usuarios-vem-user-providers">
<h3>De onde os usuários vêm? (<em>User Providers</em>)<a class="headerlink" href="#de-onde-os-usuarios-vem-user-providers" title="Permalink to this headline">¶</a></h3>
<p>Durante a autenticação, o usuário submete um conjunto de credenciais (normalmente
login e senha). O trabalho do sistema de autenticação é verificar essas credenciais
contra um conjunto de usuários. De onde essa lista de usuários vem então?</p>
<p>No Symfony2, usuários podem vir de qualquer lugar - um arquivo de configuração,
um banco de dados, um serviço web ou qualquer outra fonte que desejar. Qualquer
coisa que disponibiliza um ou mais usuários para o sistema de autenticação é conhecido
como &#8220;user provider&#8221;. O Symfony2 vem por padrão com os dois mais comuns: um que
carrega os usuários do arquivo de configuração e outro que carrega os usuários do
banco de dados.</p>
<div class="section" id="especificando-usuarios-no-arquivo-de-configuracao">
<h4>Especificando usuários no arquivo de configuração<a class="headerlink" href="#especificando-usuarios-no-arquivo-de-configuracao" title="Permalink to this headline">¶</a></h4>
<p>O jeito mais fácil de especificar usuários é diretamnete no arquivo de configuração.
De fato, você já viu isso em um exemplo neste capítulo.</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/config.yml</span>
<span class="l-Scalar-Plain">security</span><span class="p-Indicator">:</span>
    <span class="c1"># ...</span>
    <span class="l-Scalar-Plain">providers</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">default_provider</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">users</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">ryan</span><span class="p-Indicator">:</span>  <span class="p-Indicator">{</span> <span class="nv">password</span><span class="p-Indicator">:</span> <span class="nv">ryanpass</span><span class="p-Indicator">,</span> <span class="nv">roles</span><span class="p-Indicator">:</span> <span class="s">&#39;ROLE_USER&#39;</span> <span class="p-Indicator">}</span>
                <span class="l-Scalar-Plain">admin</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span> <span class="nv">password</span><span class="p-Indicator">:</span> <span class="nv">kitten</span><span class="p-Indicator">,</span> <span class="nv">roles</span><span class="p-Indicator">:</span> <span class="s">&#39;ROLE_ADMIN&#39;</span> <span class="p-Indicator">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/config.xml --&gt;</span>
<span class="nt">&lt;config&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
    <span class="nt">&lt;provider</span> <span class="na">name=</span><span class="s">&quot;default_provider&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;user</span> <span class="na">name=</span><span class="s">&quot;ryan&quot;</span> <span class="na">password=</span><span class="s">&quot;ryanpass&quot;</span> <span class="na">roles=</span><span class="s">&quot;ROLE_USER&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;user</span> <span class="na">name=</span><span class="s">&quot;admin&quot;</span> <span class="na">password=</span><span class="s">&quot;kitten&quot;</span> <span class="na">roles=</span><span class="s">&quot;ROLE_ADMIN&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/provider&gt;</span>
<span class="nt">&lt;/config&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// app/config/config.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="c1">// ...</span>
    <span class="s1">&#39;providers&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;default_provider&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;users&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;ryan&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ryanpass&#39;</span><span class="p">,</span> <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_USER&#39;</span><span class="p">),</span>
                <span class="s1">&#39;admin&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;kitten&#39;</span><span class="p">,</span> <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">),</span>
            <span class="p">),</span>
        <span class="p">),</span>
    <span class="p">),</span>
<span class="p">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>Este <em>user provider</em> é chamado de &#8220;in-memory&#8221; user provider, já que os
usuários não estão armazenados em nenhum banco de dados. O objeto usuário
é fornecido pelo Symfony (<tt class="docutils literal"><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Security/Core/User/User.html" title="Symfony\Component\Security\Core\User\User"><span class="pre">User</span></a></tt>).</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Qualquer user provider pode carregar usuários diretamente da configuração se
especificar o parâmetro de configuração <tt class="docutils literal"><span class="pre">users</span></tt> e listar os usuários
abaixo dele.</p>
</div>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p>Se seu login é todo numérico (<tt class="docutils literal"><span class="pre">77</span></tt>, por exemplo) ou contém hífen (<tt class="docutils literal"><span class="pre">user-name</span></tt>, por exemplo),
você deveria utilizar a sintaxe alternativa quando especificar usuários em YAML:</p>
<div class="last highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">users</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="p-Indicator">{</span> <span class="nv">name</span><span class="p-Indicator">:</span> <span class="nv">77</span><span class="p-Indicator">,</span> <span class="nv">password</span><span class="p-Indicator">:</span> <span class="nv">pass</span><span class="p-Indicator">,</span> <span class="nv">roles</span><span class="p-Indicator">:</span> <span class="s">&#39;ROLE_USER&#39;</span> <span class="p-Indicator">}</span>
    <span class="p-Indicator">-</span> <span class="p-Indicator">{</span> <span class="nv">name</span><span class="p-Indicator">:</span> <span class="nv">user-name</span><span class="p-Indicator">,</span> <span class="nv">password</span><span class="p-Indicator">:</span> <span class="nv">pass</span><span class="p-Indicator">,</span> <span class="nv">roles</span><span class="p-Indicator">:</span> <span class="s">&#39;ROLE_USER&#39;</span> <span class="p-Indicator">}</span>
</pre></div>
</div>
</div>
<p>Para sites menores, este método é rápido e fácil de configurar. Para sistemas mais complexos,
você provavelmente desejará carregar os usuários do banco de dados.</p>
</div>
<div class="section" id="carregando-usuarios-do-banco-de-dados">
<span id="book-security-user-entity"></span><h4>Carregando usuários do banco de dados<a class="headerlink" href="#carregando-usuarios-do-banco-de-dados" title="Permalink to this headline">¶</a></h4>
<p>Se você desejar carregar seus usuários através do Doctrine ORM, você pode
facilmente o fazer criando uma classe <tt class="docutils literal"><span class="pre">User</span></tt> e configurando o <tt class="docutils literal"><span class="pre">entity</span></tt> provider</p>
<p>Nessa abordagem, você primeiro precisa criar sua própria classe <tt class="docutils literal"><span class="pre">User</span></tt>, que
será persistida no banco de dados.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Acme/UserBundle/Entity/User.php</span>
<span class="k">namespace</span> <span class="nx">Acme\UserBundle\Entity</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Security\Core\User\UserInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\ORM\Mapping</span> <span class="k">as</span> <span class="nx">ORM</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * @ORM\Entity</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">User</span> <span class="k">implements</span> <span class="nx">UserInterface</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @ORM\Column(type=&quot;string&quot;, length=&quot;255&quot;)</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$username</span><span class="p">;</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Ao que diz respeito ao sistema de segurança, o único requisito para sua
classe <tt class="docutils literal"><span class="pre">User</span></tt> personalizada é que ela implemente a interface
<tt class="docutils literal"><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserInterface.html" title="Symfony\Component\Security\Core\User\UserInterface"><span class="pre">UserInterface</span></a></tt> . Isto significa
que conceito de usuário pode ser qualquer um, desde que implemente essa interface.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">O objeto User será serializado e salvo na sessão entre requisições, por isso
é recomendado que você <a class="reference external" href="http://php.net/manual/en/class.serializable.php">implemente a interface Serializable</a> em sua classe User.
Isto é especialmente importante se sua classe <tt class="docutils literal"><span class="pre">User</span></tt> tem uma classe pai com
propriedades private.</p>
</div>
<p>Em seguida, configure um user provider <tt class="docutils literal"><span class="pre">entity</span></tt> e aponte-o para sua classe <tt class="docutils literal"><span class="pre">User</span></tt>:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/security.yml</span>
<span class="l-Scalar-Plain">security</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">providers</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">main</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">entity</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span> <span class="nv">class</span><span class="p-Indicator">:</span> <span class="nv">Acme\UserBundle\Entity\User</span><span class="p-Indicator">,</span> <span class="nv">property</span><span class="p-Indicator">:</span> <span class="nv">username</span> <span class="p-Indicator">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/security.xml --&gt;</span>
<span class="nt">&lt;config&gt;</span>
    <span class="nt">&lt;provider</span> <span class="na">name=</span><span class="s">&quot;main&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;entity</span> <span class="na">class=</span><span class="s">&quot;Acme\UserBundle\Entity\User&quot;</span> <span class="na">property=</span><span class="s">&quot;username&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/provider&gt;</span>
<span class="nt">&lt;/config&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// app/config/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;providers&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;main&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;entity&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;class&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Acme\UserBundle\Entity\User&#39;</span><span class="p">,</span> <span class="s1">&#39;property&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;username&#39;</span><span class="p">),</span>
        <span class="p">),</span>
    <span class="p">),</span>
<span class="p">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>Com a introdução desse novo provider, o sistema de autenticação tentará
carregar o objeto <tt class="docutils literal"><span class="pre">User</span></tt> do banco de dados a partir do campo <tt class="docutils literal"><span class="pre">username</span></tt> da classe.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Este exemplo é somente para demonstrar a idéia básica por trás do provider <tt class="docutils literal"><span class="pre">entity</span></tt>.
Para um exemplo completo, consulte <tt class="xref doc docutils literal"><span class="pre">/cookbook/security/entity_provider</span></tt>.</p>
</div>
<p>Para mais informações sobre como criar seu próprio provider (se precisar carregar usuários
do seu serviço web por exemplo), consulte <tt class="xref doc docutils literal"><span class="pre">/cookbook/security/custom_provider</span></tt>.</p>
</div>
</div>
<div class="section" id="protegendo-a-senha-do-usuario">
<h3>Protegendo a senha do usuário<a class="headerlink" href="#protegendo-a-senha-do-usuario" title="Permalink to this headline">¶</a></h3>
<p>Até agora, por simplicidade, todos os exemplos armazenavam as senhas dos usuários
em texto puro (sendo armazenados no arquivo de configuração ou no banco de dados).
Claro que em um aplicativo profissional você desejará proteger as senhas dos seus
usuários por questões de segurança. Isto é facilmente conseguido mapeando sua
classe User para algum &#8220;encoder&#8221; disponível. Por exemplo, para armazenar seus
usuário em memória, mas proteger a senha deles através da função de hash <cite>sha1`</cite>,
faça o seguinte:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/config.yml</span>
<span class="l-Scalar-Plain">security</span><span class="p-Indicator">:</span>
    <span class="c1"># ...</span>
    <span class="l-Scalar-Plain">providers</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">in_memory</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">users</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">ryan</span><span class="p-Indicator">:</span>  <span class="p-Indicator">{</span> <span class="nv">password</span><span class="p-Indicator">:</span> <span class="nv">bb87a29949f3a1ee0559f8a57357487151281386</span><span class="p-Indicator">,</span> <span class="nv">roles</span><span class="p-Indicator">:</span> <span class="s">&#39;ROLE_USER&#39;</span> <span class="p-Indicator">}</span>
                <span class="l-Scalar-Plain">admin</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span> <span class="nv">password</span><span class="p-Indicator">:</span> <span class="nv">74913f5cd5f61ec0bcfdb775414c2fb3d161b620</span><span class="p-Indicator">,</span> <span class="nv">roles</span><span class="p-Indicator">:</span> <span class="s">&#39;ROLE_ADMIN&#39;</span> <span class="p-Indicator">}</span>

    <span class="l-Scalar-Plain">encoders</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">Symfony\Component\Security\Core\User\User</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">algorithm</span><span class="p-Indicator">:</span>   <span class="l-Scalar-Plain">sha1</span>
            <span class="l-Scalar-Plain">iterations</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">1</span>
            <span class="l-Scalar-Plain">encode_as_base64</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/config.xml --&gt;</span>
<span class="nt">&lt;config&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
    <span class="nt">&lt;provider</span> <span class="na">name=</span><span class="s">&quot;in_memory&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;user</span> <span class="na">name=</span><span class="s">&quot;ryan&quot;</span> <span class="na">password=</span><span class="s">&quot;bb87a29949f3a1ee0559f8a57357487151281386&quot;</span> <span class="na">roles=</span><span class="s">&quot;ROLE_USER&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;user</span> <span class="na">name=</span><span class="s">&quot;admin&quot;</span> <span class="na">password=</span><span class="s">&quot;74913f5cd5f61ec0bcfdb775414c2fb3d161b620&quot;</span> <span class="na">roles=</span><span class="s">&quot;ROLE_ADMIN&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/provider&gt;</span>

    <span class="nt">&lt;encoder</span> <span class="na">class=</span><span class="s">&quot;Symfony\Component\Security\Core\User\User&quot;</span> <span class="na">algorithm=</span><span class="s">&quot;sha1&quot;</span> <span class="na">iterations=</span><span class="s">&quot;1&quot;</span> <span class="na">encode_as_base64=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/config&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// app/config/config.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="c1">// ...</span>
    <span class="s1">&#39;providers&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;in_memory&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;users&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;ryan&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bb87a29949f3a1ee0559f8a57357487151281386&#39;</span><span class="p">,</span> <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_USER&#39;</span><span class="p">),</span>
                <span class="s1">&#39;admin&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;74913f5cd5f61ec0bcfdb775414c2fb3d161b620&#39;</span><span class="p">,</span> <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">),</span>
            <span class="p">),</span>
        <span class="p">),</span>
    <span class="p">),</span>
    <span class="s1">&#39;encoders&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;Symfony\Component\Security\Core\User\User&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;algorithm&#39;</span>         <span class="o">=&gt;</span> <span class="s1">&#39;sha1&#39;</span><span class="p">,</span>
            <span class="s1">&#39;iterations&#39;</span>        <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;encode_as_base64&#39;</span>  <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">),</span>
<span class="p">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>Ao definir <tt class="docutils literal"><span class="pre">iterations</span></tt> como <tt class="docutils literal"><span class="pre">1</span></tt> e <tt class="docutils literal"><span class="pre">encode_as_base64</span></tt> como false, a senha codificada
é simplesmente obtida como o resultado de <tt class="docutils literal"><span class="pre">sha1</span></tt> após uma iteração apenas, sem codificação
extra. Você pode agora calcular a senha codificada por código PHP (e.g. <tt class="docutils literal"><span class="pre">hash('sha1',</span> <span class="pre">'ryanpass')</span></tt>)
ou através de alguma ferramenta online como <a class="reference external" href="http://www.functions-online.com/sha1.html">functions-online.com</a> .</p>
<p>Se você estiver criando seus usuário dinamicamente e os armazenando no banco de dados,
você pode usar algoritmos the hash ainda mais complexos e então delegar em um objeto
encoder para ajudar a codificar as senhas. Por exemplo, suponha que seu objeto User é
<tt class="docutils literal"><span class="pre">Acme\UserBundle\Entity\User</span></tt> (como no exemplo acima). Primeiro, configure o encoder para
aquele usuário:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/config.yml</span>
<span class="l-Scalar-Plain">security</span><span class="p-Indicator">:</span>
    <span class="c1"># ...</span>

    <span class="l-Scalar-Plain">encoders</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">Acme\UserBundle\Entity\User</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sha512</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/config.xml --&gt;</span>
<span class="nt">&lt;config&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>

    <span class="nt">&lt;encoder</span> <span class="na">class=</span><span class="s">&quot;Acme\UserBundle\Entity\User&quot;</span> <span class="na">algorithm=</span><span class="s">&quot;sha512&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/config&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// app/config/config.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="c1">// ...</span>

    <span class="s1">&#39;encoders&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;Acme\UserBundle\Entity\User&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;sha512&#39;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>Neste caso, você está utilizando um algoritmo mais forte <tt class="docutils literal"><span class="pre">sha512</span></tt>. Além disso,
desde que você especificou o algoritmo (<tt class="docutils literal"><span class="pre">sha512</span></tt>) como um texto, o sistema
irá, por padrão, utilizar a função de hash 5000 vezes em uma linha e então o codificar
como base64. Em outras palavras, a senha foi muito codificada de maneira que a senha
não pode ser decodificada (isto é, você não pode determinar qual a senha
a partir da senha codificada).</p>
<p>Se você tem alguma espécie de formulário de registro para os visitantes, você precisará
a senha codificada para poder armazenar. Não importa o algoritmo que configurar para
sua classe User, a senha codificada pode sempre ser determinada da seguinte maneira
a partir de um controller:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$factory</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;security.encoder_factory&#39;</span><span class="p">);</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Acme\UserBundle\Entity\User</span><span class="p">();</span>

<span class="nv">$encoder</span> <span class="o">=</span> <span class="nv">$factory</span><span class="o">-&gt;</span><span class="na">getEncoder</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
<span class="nv">$password</span> <span class="o">=</span> <span class="nv">$encoder</span><span class="o">-&gt;</span><span class="na">encodePassword</span><span class="p">(</span><span class="s1">&#39;ryanpass&#39;</span><span class="p">,</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getSalt</span><span class="p">());</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$password</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="obtendo-o-objeto-user">
<h3>Obtendo o objeto User<a class="headerlink" href="#obtendo-o-objeto-user" title="Permalink to this headline">¶</a></h3>
<p>Após a autenticação, o objeto <tt class="docutils literal"><span class="pre">User</span></tt> do usuário atual pode ser acessado através
do serviço <tt class="docutils literal"><span class="pre">security.context</span></tt>. De dentro de um controller, faça o seguinte:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">public</span> <span class="k">function</span> <span class="nf">indexAction</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;security.context&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getToken</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No controller, também existe o atalho:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">public</span> <span class="k">function</span> <span class="nf">indexAction</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Usuários anônimos são tecnicamente autenticados, significando que o médodo <tt class="docutils literal"><span class="pre">isAuthenticated()</span></tt>
de um objeto User autenticado anonimamente retornará verdadeiro. Para verificar se seu usuário está
realmente autenticado, verifique se o perfil <tt class="docutils literal"><span class="pre">IS_AUTHENTICATED_FULLY</span></tt> está atribuído ao mesmo.</p>
</div>
</div>
<div class="section" id="utilizando-multiplos-user-providers">
<h3>Utilizando múltiplos User Providers<a class="headerlink" href="#utilizando-multiplos-user-providers" title="Permalink to this headline">¶</a></h3>
<p>Cada mecanismo de autenticação (exemplos: Autenticação HTTP, formulário de login, etc)
usa exatamente um user provider, e utilizará, por padrão, o primeiro user provider configurado. O que acontece
se você quiser que alguns de seus usuários sejam autenticados por arquivo de configuração e o
resto por banco de dados? Isto é possível criando um novo user provider que ativa os dois juntos:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/security.yml</span>
<span class="l-Scalar-Plain">security</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">providers</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">chain_provider</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">providers</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">in_memory</span><span class="p-Indicator">,</span> <span class="nv">user_db</span><span class="p-Indicator">]</span>
        <span class="l-Scalar-Plain">in_memory</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">users</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">foo</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span> <span class="nv">password</span><span class="p-Indicator">:</span> <span class="nv">test</span> <span class="p-Indicator">}</span>
        <span class="l-Scalar-Plain">user_db</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">entity</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span> <span class="nv">class</span><span class="p-Indicator">:</span> <span class="nv">Acme\UserBundle\Entity\User</span><span class="p-Indicator">,</span> <span class="nv">property</span><span class="p-Indicator">:</span> <span class="nv">username</span> <span class="p-Indicator">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/config.xml --&gt;</span>
<span class="nt">&lt;config&gt;</span>
    <span class="nt">&lt;provider</span> <span class="na">name=</span><span class="s">&quot;chain_provider&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;provider&gt;</span>in_memory<span class="nt">&lt;/provider&gt;</span>
        <span class="nt">&lt;provider&gt;</span>user_db<span class="nt">&lt;/provider&gt;</span>
    <span class="nt">&lt;/provider&gt;</span>
    <span class="nt">&lt;provider</span> <span class="na">name=</span><span class="s">&quot;in_memory&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;user</span> <span class="na">name=</span><span class="s">&quot;foo&quot;</span> <span class="na">password=</span><span class="s">&quot;test&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/provider&gt;</span>
    <span class="nt">&lt;provider</span> <span class="na">name=</span><span class="s">&quot;user_db&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;entity</span> <span class="na">class=</span><span class="s">&quot;Acme\UserBundle\Entity\User&quot;</span> <span class="na">property=</span><span class="s">&quot;username&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/provider&gt;</span>
<span class="nt">&lt;/config&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// app/config/config.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;providers&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;chain_provider&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;providers&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;in_memory&#39;</span><span class="p">,</span> <span class="s1">&#39;user_db&#39;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="s1">&#39;in_memory&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;users&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;test&#39;</span><span class="p">),</span>
            <span class="p">),</span>
        <span class="p">),</span>
        <span class="s1">&#39;user_db&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;entity&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;class&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Acme\UserBundle\Entity\User&#39;</span><span class="p">,</span> <span class="s1">&#39;property&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;username&#39;</span><span class="p">),</span>
        <span class="p">),</span>
    <span class="p">),</span>
<span class="p">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>Agora, todos mecanismos de autenticação utilizarão o <tt class="docutils literal"><span class="pre">chain_provider</span></tt>, já que é
o primeiro configurado. O <tt class="docutils literal"><span class="pre">chain_provider</span></tt> tentará carregar o usuário de ambos
providers <tt class="docutils literal"><span class="pre">in_memory</span></tt> e <tt class="docutils literal"><span class="pre">user_db</span></tt>.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Se você não tem razões para separar seus usuários <tt class="docutils literal"><span class="pre">in_memory</span></tt> dos seus
usuários <tt class="docutils literal"><span class="pre">user_db</span></tt>, você pode conseguir o mesmo resultado mais facilmente,
combinando as duas origens em um único provider:</p>
<div class="last configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/security.yml</span>
<span class="l-Scalar-Plain">security</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">providers</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">main_provider</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">users</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">foo</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span> <span class="nv">password</span><span class="p-Indicator">:</span> <span class="nv">test</span> <span class="p-Indicator">}</span>
            <span class="l-Scalar-Plain">entity</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span> <span class="nv">class</span><span class="p-Indicator">:</span> <span class="nv">Acme\UserBundle\Entity\User</span><span class="p-Indicator">,</span> <span class="nv">property</span><span class="p-Indicator">:</span> <span class="nv">username</span> <span class="p-Indicator">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/config.xml --&gt;</span>
<span class="nt">&lt;config&gt;</span>
    <span class="nt">&lt;provider</span> <span class="na">name=</span><span class="s">=&quot;main_provider&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;user</span> <span class="na">name=</span><span class="s">&quot;foo&quot;</span> <span class="na">password=</span><span class="s">&quot;test&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;entity</span> <span class="na">class=</span><span class="s">&quot;Acme\UserBundle\Entity\User&quot;</span> <span class="na">property=</span><span class="s">&quot;username&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/provider&gt;</span>
<span class="nt">&lt;/config&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// app/config/config.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;providers&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;main_provider&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;users&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;test&#39;</span><span class="p">),</span>
            <span class="p">),</span>
            <span class="s1">&#39;entity&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;class&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Acme\UserBundle\Entity\User&#39;</span><span class="p">,</span> <span class="s1">&#39;property&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;username&#39;</span><span class="p">),</span>
        <span class="p">),</span>
    <span class="p">),</span>
<span class="p">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<p>Você pode ainda configurar o firewall ou mecanismos de autenticação individuais para utilizar
um user provider específico. Novamente, a menos que um provider seja especificado explicitamente,
o primeiro será sempre utilizado:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/config.yml</span>
<span class="l-Scalar-Plain">security</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">firewalls</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">secured_area</span><span class="p-Indicator">:</span>
            <span class="c1"># ...</span>
            <span class="l-Scalar-Plain">provider</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">user_db</span>
            <span class="l-Scalar-Plain">http_basic</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">realm</span><span class="p-Indicator">:</span> <span class="s">&quot;Secured</span><span class="nv"> </span><span class="s">Demo</span><span class="nv"> </span><span class="s">Area&quot;</span>
                <span class="l-Scalar-Plain">provider</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">in_memory</span>
            <span class="l-Scalar-Plain">form_login</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">~</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/config.xml --&gt;</span>
<span class="nt">&lt;config&gt;</span>
    <span class="nt">&lt;firewall</span> <span class="na">name=</span><span class="s">&quot;secured_area&quot;</span> <span class="na">pattern=</span><span class="s">&quot;^/&quot;</span> <span class="na">provider=</span><span class="s">&quot;user_db&quot;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>
        <span class="nt">&lt;http-basic</span> <span class="na">realm=</span><span class="s">&quot;Secured Demo Area&quot;</span> <span class="na">provider=</span><span class="s">&quot;in_memory&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;form-login</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/firewall&gt;</span>
<span class="nt">&lt;/config&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// app/config/config.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;firewalls&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;secured_area&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="c1">// ...</span>
            <span class="s1">&#39;provider&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;user_db&#39;</span><span class="p">,</span>
            <span class="s1">&#39;http_basic&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="c1">// ...</span>
                <span class="s1">&#39;provider&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;in_memory&#39;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="s1">&#39;form_login&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(),</span>
        <span class="p">),</span>
    <span class="p">),</span>
<span class="p">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>Neste exemplo, se um usuário tentar se autenticar através de autenticação HTTP, o sistema
utilizará o user provider  <tt class="docutils literal"><span class="pre">in_memory</span></tt>. Se o usuário tentar, porém, se autenticar através
do formulário de login, o provider <tt class="docutils literal"><span class="pre">user_db</span></tt> será usado (pois é o padrão para todo o firewall).</p>
<p>Para mais informações sobre a configuração do user provider e do firewall,
veja <tt class="xref doc docutils literal"><span class="pre">/reference/configuration/security</span></tt>.</p>
</div>
</div>
<div class="section" id="perfis-roles">
<h2>Perfis (Roles)<a class="headerlink" href="#perfis-roles" title="Permalink to this headline">¶</a></h2>
<p>A idéia de um &#8220;perfil&#8221; é chave no processo de autorização. Para cada usuário é atribuído
um conjunto de perfis e então cada recurso exige um ou mais perfis. Se um usuário
tem os perfis requeridos, o acesso é concedido. Caso contrário, o acesso é negado.</p>
<p>Perfis são muito simples e basicamente textos que você pode inventar e utilizar
de acordo com suas necessidades (embora perfis sejam objetos PHP internamente).
Por exemplo, se precisar limitar acesso a uma seção administrativa do blog
de seu website, você pode proteger a seção utilizando o perfil <tt class="docutils literal"><span class="pre">ROLE_BLOG_ADMIN</span></tt>.
Este perfil não precisa de estar definido em lugar nenhum - você pode simplesmente
usar o mesmo.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Todos os perfis <strong>devem</strong> começar com o prefixo <tt class="docutils literal"><span class="pre">ROLE_</span></tt> para serem gerenciados
pelo Symfony2. Se você definir seus próprios perfis com uma classe <tt class="docutils literal"><span class="pre">Role</span></tt>
dedicada (mais avançado), não utilize o prefixo <tt class="docutils literal"><span class="pre">ROLE_</span></tt>.</p>
</div>
<div class="section" id="hierarquia-de-perfis">
<h3>Hierarquia de Perfis<a class="headerlink" href="#hierarquia-de-perfis" title="Permalink to this headline">¶</a></h3>
<p>Ao invés de associar muitos perfis aos usuários, você pode defined regras
de herança ao criar uma hierarquia de perfis:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/security.yml</span>
<span class="l-Scalar-Plain">security</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">role_hierarchy</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">ROLE_ADMIN</span><span class="p-Indicator">:</span>       <span class="l-Scalar-Plain">ROLE_USER</span>
        <span class="l-Scalar-Plain">ROLE_SUPER_ADMIN</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">ROLE_ADMIN</span><span class="p-Indicator">,</span> <span class="nv">ROLE_ALLOWED_TO_SWITCH</span><span class="p-Indicator">]</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/security.xml --&gt;</span>
<span class="nt">&lt;config&gt;</span>
    <span class="nt">&lt;role</span> <span class="na">id=</span><span class="s">&quot;ROLE_ADMIN&quot;</span><span class="nt">&gt;</span>ROLE_USER<span class="nt">&lt;/role&gt;</span>
    <span class="nt">&lt;role</span> <span class="na">id=</span><span class="s">&quot;ROLE_SUPER_ADMIN&quot;</span><span class="nt">&gt;</span>ROLE_ADMIN, ROLE_ALLOWED_TO_SWITCH<span class="nt">&lt;/role&gt;</span>
<span class="nt">&lt;/config&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// app/config/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;role_hierarchy&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;ROLE_ADMIN&#39;</span>       <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_USER&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ROLE_SUPER_ADMIN&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">,</span> <span class="s1">&#39;ROLE_ALLOWED_TO_SWITCH&#39;</span><span class="p">),</span>
    <span class="p">),</span>
<span class="p">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>Na configuração acima, usuários com o perfil <tt class="docutils literal"><span class="pre">ROLE_ADMIN</span></tt> terão também o perfil <tt class="docutils literal"><span class="pre">ROLE_USER</span></tt>.
O perfil <tt class="docutils literal"><span class="pre">ROLE_SUPER_ADMIN</span></tt> tem os <tt class="docutils literal"><span class="pre">ROLE_ADMIN</span></tt>, <tt class="docutils literal"><span class="pre">ROLE_ALLOWED_TO_SWITCH</span></tt> e <tt class="docutils literal"><span class="pre">ROLE_USER</span></tt>
(herdado do <tt class="docutils literal"><span class="pre">ROLE_ADMIN</span></tt>).</p>
</div>
</div>
<div class="section" id="saindo-do-sistema">
<h2>Saindo do sistema<a class="headerlink" href="#saindo-do-sistema" title="Permalink to this headline">¶</a></h2>
<p>Normalmente, você também quer que seus usuários possam sair do sistema.
Felizmente, o firewall consegue lidar com isso automaticamente quando o parâmetro
de configuração <tt class="docutils literal"><span class="pre">logout</span></tt> está ativo:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/config.yml</span>
<span class="l-Scalar-Plain">security</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">firewalls</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">secured_area</span><span class="p-Indicator">:</span>
            <span class="c1"># ...</span>
            <span class="l-Scalar-Plain">logout</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">path</span><span class="p-Indicator">:</span>   <span class="l-Scalar-Plain">/logout</span>
                <span class="l-Scalar-Plain">target</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/config.xml --&gt;</span>
<span class="nt">&lt;config&gt;</span>
    <span class="nt">&lt;firewall</span> <span class="na">name=</span><span class="s">&quot;secured_area&quot;</span> <span class="na">pattern=</span><span class="s">&quot;^/&quot;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>
        <span class="nt">&lt;logout</span> <span class="na">path=</span><span class="s">&quot;/logout&quot;</span> <span class="na">target=</span><span class="s">&quot;/&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/firewall&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;/config&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// app/config/config.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;firewalls&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;secured_area&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="c1">// ...</span>
            <span class="s1">&#39;logout&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;logout&#39;</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/&#39;</span><span class="p">),</span>
        <span class="p">),</span>
    <span class="p">),</span>
    <span class="c1">// ...</span>
<span class="p">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>Uma vez que está configurado no seu firewall, redirecionando o usuário para <tt class="docutils literal"><span class="pre">/logout</span></tt>
(ou qualquer outro caminho que configurar em <tt class="docutils literal"><span class="pre">path</span></tt>), o usuário não estará
mais autenticado. O usuário será então redirecionado para a página principal
(o valor definido no parâmetro <tt class="docutils literal"><span class="pre">target</span></tt>). Ambas configurações <tt class="docutils literal"><span class="pre">path</span></tt> e <tt class="docutils literal"><span class="pre">target</span></tt>
tem valor padrão iguais ao especificado aqui. Em outras palavras, a menos que
precise personalizar, você pode simplesmente os omitir completamente e simplificar
sua configuração:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">logout</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">~</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;logout</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="s1">&#39;logout&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(),</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>Note que você <em>não</em> precisará implementar o controller para a URL <tt class="docutils literal"><span class="pre">/logout</span></tt>
já que o firewall cuida disso. Você pode, porém, querer criar uma rota para que
possa usar para gerar a URL:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/routing.yml</span>
<span class="l-Scalar-Plain">logout</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">pattern</span><span class="p-Indicator">:</span>   <span class="l-Scalar-Plain">/logout</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/routing.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>

<span class="nt">&lt;routes</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/routing&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/routing http://symfony.com/schema/routing/routing-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;route</span> <span class="na">id=</span><span class="s">&quot;logout&quot;</span> <span class="na">pattern=</span><span class="s">&quot;/logout&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/routes&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// app/config/routing.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\RouteCollection</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Route</span><span class="p">;</span>

<span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RouteCollection</span><span class="p">();</span>
<span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;logout&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Route</span><span class="p">(</span><span class="s1">&#39;/logout&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">()));</span>

<span class="k">return</span> <span class="nv">$collection</span><span class="p">;</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>Uma vez que o usuário não está mais autenticado, ele será redirecionado para o
que tiver definido no parâmetro <tt class="docutils literal"><span class="pre">target</span></tt>. Para mais informações sobre
a configuração de logout, veja
<tt class="xref doc docutils literal"><span class="pre">Security</span> <span class="pre">Configuration</span> <span class="pre">Reference</span></tt>.</p>
</div>
<div class="section" id="controle-de-acesso-em-templates">
<h2>Controle de Acesso em Templates<a class="headerlink" href="#controle-de-acesso-em-templates" title="Permalink to this headline">¶</a></h2>
<p>Se você quiser checar se o usuário atual tem um determinado perfil de dentro de
uma template, use a função:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>Twig</em><div class="highlight-html+jinja"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">if</span> <span class="nv">is_granted</span><span class="o">(</span><span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="o">)</span> <span class="cp">%}</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;...&quot;</span><span class="nt">&gt;</span>Delete<span class="nt">&lt;/a&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$view</span><span class="p">[</span><span class="s1">&#39;security&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span><span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">))</span><span class="o">:</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;...&quot;</span><span class="nt">&gt;</span>Delete<span class="nt">&lt;/a&gt;</span>
<span class="cp">&lt;?php</span> <span class="k">endif</span><span class="p">;</span> <span class="cp">?&gt;</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Se você usar esta função e <em>não</em> estiver em uma URL que está atrás de um
firewall ativo, uma exceção será gerada. Novamente, quase sempre é uma boa
idéia ter um firewall principal que protege todas as URLs (como visto neste
capítulo).</p>
</div>
</div>
<div class="section" id="controle-de-acesso-em-controllers">
<h2>Controle de Acesso em Controllers<a class="headerlink" href="#controle-de-acesso-em-controllers" title="Permalink to this headline">¶</a></h2>
<p>Se você quer verificar se o usuário atual tem um perfil de dentro de um controller,
use o método <tt class="docutils literal"><span class="pre">isGranted</span></tt> do contexto de segurança:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">public</span> <span class="k">function</span> <span class="nf">indexAction</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// show different content to admin users</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;security.context&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span><span class="s1">&#39;ADMIN&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// Load admin content here</span>
    <span class="p">}</span>
    <span class="c1">// load other regular content here</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Um firewall deve estar ativo ou uma exceção será gerada quanto o método <tt class="docutils literal"><span class="pre">isGranted</span></tt>
for chamado. Veja a nota acima sobre templates para mais detalhes.</p>
</div>
</div>
<div class="section" id="passando-por-outro-usuario">
<h2>Passando por outro usuário<a class="headerlink" href="#passando-por-outro-usuario" title="Permalink to this headline">¶</a></h2>
<p>As vezes, é útil poder trocar de um usuário para outro sem ter que sair e se
autenticar novamente (por exemplo quando você está depurando or tentando entender
uma falha que um usuário vê e você não consegue reproduzir). Isto pode ser feito
ativando o listener <tt class="docutils literal"><span class="pre">switch_user</span></tt> do firewall:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/security.yml</span>
<span class="l-Scalar-Plain">security</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">firewalls</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">main</span><span class="p-Indicator">:</span>
            <span class="c1"># ...</span>
            <span class="l-Scalar-Plain">switch_user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/security.xml --&gt;</span>
<span class="nt">&lt;config&gt;</span>
    <span class="nt">&lt;firewall&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>
        <span class="nt">&lt;switch-user</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/firewall&gt;</span>
<span class="nt">&lt;/config&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// app/config/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;firewalls&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;main&#39;</span><span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="c1">// ...</span>
            <span class="s1">&#39;switch_user&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
        <span class="p">),</span>
    <span class="p">),</span>
<span class="p">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>Para mudar para outro usuário, basta adicionar o parâmetro de URL <tt class="docutils literal"><span class="pre">_switch_user</span></tt>
indicando o usuário (username) na URL atual:</p>
<blockquote>
<div><a class="reference external" href="http://example.com/somewhere?_switch_user=thomas">http://example.com/somewhere?_switch_user=thomas</a></div></blockquote>
<p>Para voltar ao usuário original, use como nome de usuário o texto <tt class="docutils literal"><span class="pre">_exit</span></tt>:</p>
<blockquote>
<div><a class="reference external" href="http://example.com/somewhere?_switch_user=_exit">http://example.com/somewhere?_switch_user=_exit</a></div></blockquote>
<p>Claro que esta funcionalidade precisar estar disponível para um grupo reduzido de usuários.
Por padrão, o acesso é restrito a usuários que tem o perfil <tt class="docutils literal"><span class="pre">ROLE_ALLOWED_TO_SWITCH</span></tt>.
O nome deste perfil pode ser modificado através do parâmetro de configuração <tt class="docutils literal"><span class="pre">role</span></tt>.
Para segurança extra, você pode ainda mudar o nome do parâmetro de URL através da
configuração <tt class="docutils literal"><span class="pre">parameter</span></tt>:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/security.yml</span>
<span class="l-Scalar-Plain">security</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">firewalls</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">main</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">// ...</span>
            <span class="l-Scalar-Plain">switch_user</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span> <span class="nv">role</span><span class="p-Indicator">:</span> <span class="nv">ROLE_ADMIN</span><span class="p-Indicator">,</span> <span class="nv">parameter</span><span class="p-Indicator">:</span> <span class="nv">_want_to_be_this_user</span> <span class="p-Indicator">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/security.xml --&gt;</span>
<span class="nt">&lt;config&gt;</span>
    <span class="nt">&lt;firewall&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>
        <span class="nt">&lt;switch-user</span> <span class="na">role=</span><span class="s">&quot;ROLE_ADMIN&quot;</span> <span class="na">parameter=</span><span class="s">&quot;_want_to_be_this_user&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/firewall&gt;</span>
<span class="nt">&lt;/config&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// app/config/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;firewalls&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;main&#39;</span><span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="c1">// ...</span>
            <span class="s1">&#39;switch_user&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;role&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">,</span> <span class="s1">&#39;parameter&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;_want_to_be_this_user&#39;</span><span class="p">),</span>
        <span class="p">),</span>
    <span class="p">),</span>
<span class="p">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="autenticacao-sem-estado">
<h2>Autenticação Sem Estado<a class="headerlink" href="#autenticacao-sem-estado" title="Permalink to this headline">¶</a></h2>
<p>Por padrão, o Symfony2 confia a um cookie (a Session) para persistir o contexto de
segurança de um usuário. Se você utiliza, porém, certificados ou autenticação HTTP, por exemplo,
persistência não é necessário já que as credenciais estão disponíveis em
cada requisição. Neste caso, e se não precisar de armazenar nada entre as requisições,
você pode ativar a autenticação sem estado (que significa que nenhum cookie será criado pelo
Symfony2):</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/security.yml</span>
<span class="l-Scalar-Plain">security</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">firewalls</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">main</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">http_basic</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">~</span>
            <span class="l-Scalar-Plain">stateless</span><span class="p-Indicator">:</span>  <span class="l-Scalar-Plain">true</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/security.xml --&gt;</span>
<span class="nt">&lt;config&gt;</span>
    <span class="nt">&lt;firewall</span> <span class="na">stateless=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;http-basic</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/firewall&gt;</span>
<span class="nt">&lt;/config&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// app/config/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;firewalls&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;main&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;http_basic&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(),</span> <span class="s1">&#39;stateless&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">),</span>
    <span class="p">),</span>
<span class="p">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Se utiliza formulário de login, o Symfony2 criará um cookie mesmo se
você definir <tt class="docutils literal"><span class="pre">stateless</span></tt> como <tt class="docutils literal"><span class="pre">true</span></tt>.</p>
</div>
</div>
<div class="section" id="palavras-finais">
<h2>Palavras Finais<a class="headerlink" href="#palavras-finais" title="Permalink to this headline">¶</a></h2>
<p>Segurança pode ser um assunto profundo e complexo de se resolver em uma aplicação.
Felizmente, o componente de segurança do Symfony segue um bom modelo
baseado em <em>autenticação</em> e <em>autorização</em>. Autenticação, que sempre acontece antes,
é gerenciada pelo firewall cujo trabalho é determinar a identidade do usuário
através de diversos possíveis métodos (exemplo, autenticação HTTP, formulário de login, etc).
No passo-a-passo, você encontrará exemplos de como outros métodos de autenticação
podem ser utilizados, incluindo como implementar o funcionalidade de
&#8220;Lembrar de mim&#8221; baseada em cookie.</p>
<p>Uma vez que o usuário está autenticado, a camada de autorização pode determinar
se o usuário deve ou não deve ter acesso a um recurso específico. Comumente,
<em>perfis</em> são aplicados a URLs, classes ou métodos e se o usuário atual não
possuir o perfil, o acesso é negado. A camada de autorização, porém,
é muito mais extensa e segue o sistema de votação onde várias partes
podem determinar se o usuário atual deve ter acesso a determinado recurso.
Saiba mais sobre este e outros tópicos no passo-a-passo.</p>
</div>
<div class="section" id="aprenda-mais-do-passo-a-passo">
<h2>Aprenda mais do Passo-a-Passo<a class="headerlink" href="#aprenda-mais-do-passo-a-passo" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><tt class="xref doc docutils literal"><span class="pre">Forçando</span> <span class="pre">HTTP/HTTPS</span></tt></li>
<li><tt class="xref doc docutils literal"><span class="pre">Coloque</span> <span class="pre">usuários</span> <span class="pre">por</span> <span class="pre">IP</span> <span class="pre">na</span> <span class="pre">lista</span> <span class="pre">negra</span> <span class="pre">com</span> <span class="pre">um</span> <span class="pre">voter</span> <span class="pre">personalizado</span></tt></li>
<li><a class="reference internal" href="../cookbook/security/acl.html"><em>Listas de Controle de Acesso (ACLs)</em></a></li>
<li><tt class="xref doc docutils literal"><span class="pre">/cookbook/security/remember_me</span></tt></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Segurança</a><ul>
<li><a class="reference internal" href="#exemplo-autenticacao-basica-http">Exemplo: Autenticação Básica HTTP</a></li>
<li><a class="reference internal" href="#como-funciona-a-seguranca-autenticacao-e-autorizacao">Como funciona a segurança: Autenticação e Autorização</a><ul>
<li><a class="reference internal" href="#firewalls-autenticacao">Firewalls (Autenticação)</a></li>
<li><a class="reference internal" href="#controles-de-acesso-autorizacao">Controles de acesso (Autorização)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usando-um-formulario-de-login-em-html">Usando um formulário de login em HTML</a></li>
<li><a class="reference internal" href="#autorizacao">Autorização</a><ul>
<li><a class="reference internal" href="#protegendo-padroes-de-urls">Protegendo padrões de URLs</a></li>
<li><a class="reference internal" href="#protegendo-por-ip">Protegendo por IP</a></li>
<li><a class="reference internal" href="#protegendo-por-canal">Protegendo por canal</a></li>
<li><a class="reference internal" href="#protegendo-um-controller">Protegendo um Controller</a></li>
<li><a class="reference internal" href="#protegendo-outros-servicos">Protegendo outros serviços</a></li>
<li><a class="reference internal" href="#listas-de-controle-de-acesso-acls-protegendo-objetos-especificos-do-banco-de-dados">Listas De Controle De Acesso (ACLs): Protegendo Objetos Específicos Do Banco De Dados</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usuarios">Usuários</a><ul>
<li><a class="reference internal" href="#de-onde-os-usuarios-vem-user-providers">De onde os usuários vêm? (<em>User Providers</em>)</a><ul>
<li><a class="reference internal" href="#especificando-usuarios-no-arquivo-de-configuracao">Especificando usuários no arquivo de configuração</a></li>
<li><a class="reference internal" href="#carregando-usuarios-do-banco-de-dados">Carregando usuários do banco de dados</a></li>
</ul>
</li>
<li><a class="reference internal" href="#protegendo-a-senha-do-usuario">Protegendo a senha do usuário</a></li>
<li><a class="reference internal" href="#obtendo-o-objeto-user">Obtendo o objeto User</a></li>
<li><a class="reference internal" href="#utilizando-multiplos-user-providers">Utilizando múltiplos User Providers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#perfis-roles">Perfis (Roles)</a><ul>
<li><a class="reference internal" href="#hierarquia-de-perfis">Hierarquia de Perfis</a></li>
</ul>
</li>
<li><a class="reference internal" href="#saindo-do-sistema">Saindo do sistema</a></li>
<li><a class="reference internal" href="#controle-de-acesso-em-templates">Controle de Acesso em Templates</a></li>
<li><a class="reference internal" href="#controle-de-acesso-em-controllers">Controle de Acesso em Controllers</a></li>
<li><a class="reference internal" href="#passando-por-outro-usuario">Passando por outro usuário</a></li>
<li><a class="reference internal" href="#autenticacao-sem-estado">Autenticação Sem Estado</a></li>
<li><a class="reference internal" href="#palavras-finais">Palavras Finais</a></li>
<li><a class="reference internal" href="#aprenda-mais-do-passo-a-passo">Aprenda mais do Passo-a-Passo</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="forms.html"
                        title="previous chapter">Formulários</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="http_cache.html"
                        title="next chapter">HTTP Cache</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/book/security.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="http_cache.html" title="HTTP Cache"
             >next</a> |</li>
        <li class="right" >
          <a href="forms.html" title="Formulários"
             >previous</a> |</li>
        <li><a href="../index.html">Symfony2Docs 2.0.x documentation</a> &raquo;</li>
          <li><a href="index.html" >Livro</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Symfony Team.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>