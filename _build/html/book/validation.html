

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Validação &mdash; Symfony2Docs 2.0.x documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.0.x',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Symfony2Docs 2.0.x documentation" href="../index.html" />
    <link rel="up" title="Livro" href="index.html" />
    <link rel="next" title="Formulários" href="forms.html" />
    <link rel="prev" title="Testes" href="testing.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="forms.html" title="Formulários"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="testing.html" title="Testes"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Symfony2Docs 2.0.x documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Livro</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="validacao">
<span id="index-0"></span><h1>Validação<a class="headerlink" href="#validacao" title="Permalink to this headline">¶</a></h1>
<p>Validação é uma tarefa muito comum em aplicações web. Dado inserido em formulário
precisa ser validado. Dado também precisa ser revalidado antes de ser escrito
num banco de dados ou passado a um serviço web.</p>
<p>Symfony2 vem acompanhado com um componente <a class="reference external" href="https://github.com/symfony/Validator">Validator</a> que torna essa tarefa fácil e transparente.
Esse componente é baseado na especificação <a href="#id1"><span class="problematic" id="id2">`JSR303 Bean Validation`_</span></a>. O quê ?
Uma especificação Java no PHP? Você ouviu corretamente, mas não é tão ruim quanto parece.
Vamos olhar como isso pode ser usado no PHP.</p>
<div class="section" id="as-bases-da-validacao">
<h2>As bases da validação<a class="headerlink" href="#as-bases-da-validacao" title="Permalink to this headline">¶</a></h2>
<p>A melhor forma de entender validação é vê-la em ação. Para começar, suponha
que você criou um bom e velho objeto PHP que você precisa usar em algum lugar da
sua aplicação:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Acme/BlogBundle/Entity/Author.php</span>
<span class="k">namespace</span> <span class="nx">Acme\BlogBundle\Entity</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Author</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Até agora, essa é somente uma classe comum que serve para alguns propósitos
dentro de sua aplicação. O objetivo da validação é avisar você se um dado de
um objeto é válido ou não. Para esse trabalho, você irá configura uma lista
de regras (chamada <a class="reference internal" href="#validation-constraints"><em>constraints</em></a>) em que o objeto
deve seguir em ordem para ser validado. Essas regras podem ser especificadas por
um número de diferentes formatos (YAML, XML, annotations, ou PHP).</p>
<p>Por exemplo, para garantir que a propriedade <tt class="docutils literal"><span class="pre">$name</span></tt> não é vazia, adicione o
seguinte:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># src/Acme/BlogBundle/Resources/config/validation.yml</span>
<span class="l-Scalar-Plain">Acme\BlogBundle\Entity\Author</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span>
            <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">NotBlank</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">~</span>
</pre></div>
</div>
</li>
<li><em>Annotations</em><div class="highlight-php-annotations"><div class="highlight"><pre><span class="c1">// src/Acme/BlogBundle/Entity/Author.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Constraints</span> <span class="k">as</span> <span class="nx">Assert</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Author</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @Assert\NotBlank()</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- src/Acme/BlogBundle/Resources/config/validation.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="nt">&lt;constraint-mapping</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/constraint-mapping&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/constraint-mapping http://symfony.com/schema/dic/constraint-mapping/constraint-mapping-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;class</span> <span class="na">name=</span><span class="s">&quot;Acme\BlogBundle\Entity\Author&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;constraint</span> <span class="na">name=</span><span class="s">&quot;NotBlank&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/class&gt;</span>
<span class="nt">&lt;/constraint-mapping&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Acme/BlogBundle/Entity/Author.php</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Mapping\ClassMetadata</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Constraints\NotBlank</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Author</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$name</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">loadValidatorMetadata</span><span class="p">(</span><span class="nx">ClassMetadata</span> <span class="nv">$metadata</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$metadata</span><span class="o">-&gt;</span><span class="na">addPropertyConstraint</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">NotBlank</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<blockquote>
<div>Propriedades protected e private podem também ser validadas, bem como os métodos</div></blockquote>
<p class="last">&#8220;getter&#8221; (veja <cite>validator-constraint-targets</cite></p>
</div>
<div class="section" id="usando-o-servico-validator">
<span id="index-1"></span><h3>Usando o serviço <tt class="docutils literal"><span class="pre">validator</span></tt><a class="headerlink" href="#usando-o-servico-validator" title="Permalink to this headline">¶</a></h3>
<p>Próximo passo, para realmente validar um objeto``Author``, use o método <tt class="docutils literal"><span class="pre">validate</span></tt>
no serviço <tt class="docutils literal"><span class="pre">validator</span></tt> (classe <tt class="docutils literal"><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Validator/Validator.html" title="Symfony\Component\Validator\Validator"><span class="pre">Validator</span></a></tt>).
A tarefa do <tt class="docutils literal"><span class="pre">validator</span></tt> é fácil: ler as restrições (i.e. regras)
de uma classe e verificar se o dado no objeto satisfaz ou não aquelas restrições.
Se a validação falhar, retorna um array de erros. Observe esse
simples exemplo de dentro do controller:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Acme\BlogBundle\Entity\Author</span><span class="p">;</span>
<span class="c1">// ...</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">indexAction</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$author</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Author</span><span class="p">();</span>
    <span class="c1">// ... do something to the $author object</span>

    <span class="nv">$validator</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;validator&#39;</span><span class="p">);</span>
    <span class="nv">$errors</span> <span class="o">=</span> <span class="nv">$validator</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">(</span><span class="nv">$author</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="nb">print_r</span><span class="p">(</span><span class="nv">$errors</span><span class="p">,</span> <span class="k">true</span><span class="p">));</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="s1">&#39;The author is valid! Yes!&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Se a propriedade <tt class="docutils literal"><span class="pre">$name</span></tt> é vazia,  você verá a seguinte mensagem de
erro:</p>
<div class="highlight-text"><div class="highlight"><pre>Acme\BlogBundle\Author.name:
    This value should not be blank
</pre></div>
</div>
<p>Se você inserir um valor na propriedade <tt class="docutils literal"><span class="pre">name</span></tt>, aparecerá a feliz mensagem
de sucesso.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">A maior parte do tempo, você não irá interagir diretamente com o serviço
<tt class="docutils literal"><span class="pre">validator</span></tt> ou precisará se preocupar sobre imprimir os erros. A maior parte do tempo,
você irá usar a validação indiretamente quando lidar com dados enviados do formulário.
Para mais informações, veja: ref:<cite>book-validation-forms</cite>.</p>
</div>
<p>Você também poderia passar o conjunto de erros em um template.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;AcmeBlogBundle:Author:validate.html.twig&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;errors&#39;</span> <span class="o">=&gt;</span> <span class="nv">$errors</span><span class="p">,</span>
    <span class="p">));</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Dentro do template, você pode gerar a lista de erros exatamente necessária:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>Twig</em><div class="highlight-html+jinja"><div class="highlight"><pre><span class="c">{# src/Acme/BlogBundle/Resources/views/Author/validate.html.twig #}</span>

<span class="nt">&lt;h3&gt;</span>The author has the following errors<span class="nt">&lt;/h3&gt;</span>
<span class="nt">&lt;ul&gt;</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">error</span> <span class="k">in</span> <span class="nv">errors</span> <span class="cp">%}</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">{{</span> <span class="nv">error.message</span> <span class="cp">}}</span><span class="nt">&lt;/li&gt;</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="nt">&lt;/ul&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-html+php"><div class="highlight"><pre><span class="c">&lt;!-- src/Acme/BlogBundle/Resources/views/Author/validate.html.php --&gt;</span>

<span class="nt">&lt;h3&gt;</span>The author has the following errors<span class="nt">&lt;/h3&gt;</span>
<span class="nt">&lt;ul&gt;</span>
<span class="cp">&lt;?php</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$errors</span> <span class="k">as</span> <span class="nv">$error</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$error</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">()</span> <span class="cp">?&gt;</span><span class="nt">&lt;/li&gt;</span>
<span class="cp">&lt;?php</span> <span class="k">endforeach</span><span class="p">;</span> <span class="cp">?&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Cada erro de validação (chamado de &#8220;constraint violation&#8221;), é representado por
um objeto <tt class="docutils literal"><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Validator/ConstraintViolation.html" title="Symfony\Component\Validator\ConstraintViolation"><span class="pre">ConstraintViolation</span></a></tt> .</p>
</div>
</div>
<div class="section" id="validacao-e-formularios">
<span id="book-validation-forms"></span><span id="index-2"></span><h3>Validação e formulários<a class="headerlink" href="#validacao-e-formularios" title="Permalink to this headline">¶</a></h3>
<p>O serviço <tt class="docutils literal"><span class="pre">validator</span></tt> pode ser usado a qualquer momento para validar qualquer objeto.
Na realidade, entretanto, você irá trabalhar frequentemente com o <tt class="docutils literal"><span class="pre">validator</span></tt> indiretamente
enquanto trabalhar com formulário. A biblioteca Symfony&#8217;s form usa o serviço <tt class="docutils literal"><span class="pre">validator</span></tt>
internamente para validar o objeto oculto após os valores terem sido enviados
e fixados. As violações de restrição no objeto são convertidas em objetos <tt class="docutils literal"><span class="pre">FieldError</span></tt>
que podem ser facilmente exibidos com seu formulário. O tipico fluxo de envio do formulário
parece o seguinte dentro do controller:</p>
<div class="highlight-python"><pre>use Acme\BlogBundle\Entity\Author;
use Acme\BlogBundle\Form\AuthorType;
use Symfony\Component\HttpFoundation\Request;
// ...

public function updateAction(Request $request)
{
    $author = new Acme\BlogBundle\Entity\Author();
    $form = $this-&gt;createForm(new AuthorType(), $author);

    if ($request-&gt;getMethod() == 'POST') {
        $form-&gt;bindRequest($request);

        if ($form-&gt;isValid()) {
            // the validation passed, do something with the $author object

            $this-&gt;redirect($this-&gt;generateUrl('...'));
        }
    }

    return $this-&gt;render('BlogBundle:Author:form.html.twig', array(
        'form' =&gt; $form-&gt;createView(),
    ));
}</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Esse exemplo usa uma classe de formulários <tt class="docutils literal"><span class="pre">AuthorType</span></tt> , que não é mostrada aqui.</p>
</div>
<p>Para mais informações, veja: doc:<cite>Forms&lt;/book/forms&gt;</cite> chapter.</p>
</div>
</div>
<div class="section" id="configuracao">
<span id="book-validation-configuration"></span><span id="index-3"></span><h2>Configuração<a class="headerlink" href="#configuracao" title="Permalink to this headline">¶</a></h2>
<p>O validador do Symfony2 é abilitado por padrão, mas você deve abilitar explicitamente anotações
se você usar o método de anotação para especificar suas restrições:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/config.yml</span>
<span class="l-Scalar-Plain">framework</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">validation</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span> <span class="nv">enable_annotations</span><span class="p-Indicator">:</span> <span class="nv">true</span> <span class="p-Indicator">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/config.xml --&gt;</span>
<span class="nt">&lt;framework:config&gt;</span>
    <span class="nt">&lt;framework:validation</span> <span class="na">enable_annotations=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/framework:config&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// app/config/config.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;framework&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;validation&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;enable_annotations&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
<span class="p">)));</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="restricoes">
<span id="validation-constraints"></span><span id="index-4"></span><h2>Restrições<a class="headerlink" href="#restricoes" title="Permalink to this headline">¶</a></h2>
<p>O <tt class="docutils literal"><span class="pre">validator</span></tt> é designado para validar objtos perante <em>restrições</em> (i.e.
regras). Em ordem para validar um objeto, simplesmente mapeie uma ou mais restrições
para aquela classe e então passe para o serviço <tt class="docutils literal"><span class="pre">validator</span></tt>.</p>
<p>Por trás dos bastidores, uma restrição é simplesmente um objeto PHP que faz uma sentença
afirmativa. Na vida real, uma restrição poderia ser: &#8220;O bolo não deve queimar&#8221;.
No Symfony2, restrições são similares: elas são afirmações que uma condição
é verdadeira. Dado um valor, a restriçao irá indicar a você se o valor adere ou não às
regras da restrição.</p>
<div class="section" id="resticoes-suportadas">
<h3>Restições Suportadas<a class="headerlink" href="#resticoes-suportadas" title="Permalink to this headline">¶</a></h3>
<p>Symfony2 engloba um grande número de restrições mais frequentemente usadas:</p>
<p>Você também pode criar sua própria restrição personalizada. Esse tópico é coberto
no artigo do cookbook &#8220;<a class="reference internal" href="../cookbook/validation/custom_constraint.html"><em>Como criar uma Regra de Validação Personalizada</em></a>&#8221;  .</p>
</div>
<div class="section" id="configuracao-de-restricoes">
<span id="book-validation-constraint-configuration"></span><span id="index-5"></span><h3>Configuração de restrições<a class="headerlink" href="#configuracao-de-restricoes" title="Permalink to this headline">¶</a></h3>
<p>Algumas restrições, como <tt class="xref doc docutils literal"><span class="pre">NotBlank</span></tt>,
são simples como as outras, como a restrição <tt class="xref doc docutils literal"><span class="pre">Choice</span></tt>
, tem várias opções de configuração disponíveis. Suponha que a classe``Author``
tenha outra propriedade, <tt class="docutils literal"><span class="pre">gender</span></tt> que possa ser configurado como
&#8220;male&#8221; ou &#8220;female&#8221;:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># src/Acme/BlogBundle/Resources/config/validation.yml</span>
<span class="l-Scalar-Plain">Acme\BlogBundle\Entity\Author</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">gender</span><span class="p-Indicator">:</span>
            <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Choice</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span> <span class="nv">choices</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">male</span><span class="p-Indicator">,</span> <span class="nv">female</span><span class="p-Indicator">],</span> <span class="nv">message</span><span class="p-Indicator">:</span> <span class="nv">Choose a valid gender.</span> <span class="p-Indicator">}</span>
</pre></div>
</div>
</li>
<li><em>Annotations</em><div class="highlight-php-annotations"><div class="highlight"><pre><span class="c1">// src/Acme/BlogBundle/Entity/Author.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Constraints</span> <span class="k">as</span> <span class="nx">Assert</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Author</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @Assert\Choice(</span>
<span class="sd">     *     choices = { &quot;male&quot;, &quot;female&quot; },</span>
<span class="sd">     *     message = &quot;Choose a valid gender.&quot;</span>
<span class="sd">     * )</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$gender</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- src/Acme/BlogBundle/Resources/config/validation.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="nt">&lt;constraint-mapping</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/constraint-mapping&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/constraint-mapping http://symfony.com/schema/dic/constraint-mapping/constraint-mapping-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;class</span> <span class="na">name=</span><span class="s">&quot;Acme\BlogBundle\Entity\Author&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;gender&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;constraint</span> <span class="na">name=</span><span class="s">&quot;Choice&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;option</span> <span class="na">name=</span><span class="s">&quot;choices&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;value&gt;</span>male<span class="nt">&lt;/value&gt;</span>
                    <span class="nt">&lt;value&gt;</span>female<span class="nt">&lt;/value&gt;</span>
                <span class="nt">&lt;/option&gt;</span>
                <span class="nt">&lt;option</span> <span class="na">name=</span><span class="s">&quot;message&quot;</span><span class="nt">&gt;</span>Choose a valid gender.<span class="nt">&lt;/option&gt;</span>
            <span class="nt">&lt;/constraint&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/class&gt;</span>
<span class="nt">&lt;/constraint-mapping&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Acme/BlogBundle/Entity/Author.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Mapping\ClassMetadata</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Constraints\NotBlank</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Author</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$gender</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">loadValidatorMetadata</span><span class="p">(</span><span class="nx">ClassMetadata</span> <span class="nv">$metadata</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$metadata</span><span class="o">-&gt;</span><span class="na">addPropertyConstraint</span><span class="p">(</span><span class="s1">&#39;gender&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Choice</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;choices&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;male&#39;</span><span class="p">,</span> <span class="s1">&#39;female&#39;</span><span class="p">),</span>
            <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Choose a valid gender.&#39;</span><span class="p">,</span>
        <span class="p">)));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p id="validation-default-option">A opção de uma restrição pode sempre ser passada como um array. Algumas restrições,
entretanto, também permitem a você passar o valor de uma opção &#8220;<em>default</em>&#8221; no lugar
do array. No cado da restrição <tt class="docutils literal"><span class="pre">Choice</span></tt> , as opções <tt class="docutils literal"><span class="pre">choices</span></tt>
podem ser espeficadas dessa forma.</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># src/Acme/BlogBundle/Resources/config/validation.yml</span>
<span class="l-Scalar-Plain">Acme\BlogBundle\Entity\Author</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">gender</span><span class="p-Indicator">:</span>
            <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Choice</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">male</span><span class="p-Indicator">,</span> <span class="nv">female</span><span class="p-Indicator">]</span>
</pre></div>
</div>
</li>
<li><em>Annotations</em><div class="highlight-php-annotations"><div class="highlight"><pre><span class="c1">// src/Acme/BlogBundle/Entity/Author.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Constraints</span> <span class="k">as</span> <span class="nx">Assert</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Author</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @Assert\Choice({&quot;male&quot;, &quot;female&quot;})</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$gender</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- src/Acme/BlogBundle/Resources/config/validation.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="nt">&lt;constraint-mapping</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/constraint-mapping&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/constraint-mapping http://symfony.com/schema/dic/constraint-mapping/constraint-mapping-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;class</span> <span class="na">name=</span><span class="s">&quot;Acme\BlogBundle\Entity\Author&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;gender&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;constraint</span> <span class="na">name=</span><span class="s">&quot;Choice&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;value&gt;</span>male<span class="nt">&lt;/value&gt;</span>
                <span class="nt">&lt;value&gt;</span>female<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;/constraint&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/class&gt;</span>
<span class="nt">&lt;/constraint-mapping&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Acme/BlogBundle/Entity/Author.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Mapping\ClassMetadata</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Constraints\Choice</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Author</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$gender</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">loadValidatorMetadata</span><span class="p">(</span><span class="nx">ClassMetadata</span> <span class="nv">$metadata</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$metadata</span><span class="o">-&gt;</span><span class="na">addPropertyConstraint</span><span class="p">(</span><span class="s1">&#39;gender&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Choice</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;male&#39;</span><span class="p">,</span> <span class="s1">&#39;female&#39;</span><span class="p">)));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>Isso significa simplesmente fazer a configuração da opção mais comum de uma restrição
mais curta e rápida.</p>
<p>Se você está incerto de como especificar uma opção, ou verifique a documentação da API
para a restrição ou faça de forma segura sempre passando um array de opções
(o primeiro método mostrado acima).</p>
</div>
</div>
<div class="section" id="escopos-da-restricao">
<span id="validator-constraint-targets"></span><span id="index-6"></span><h2>Escopos da restrição<a class="headerlink" href="#escopos-da-restricao" title="Permalink to this headline">¶</a></h2>
<p>Restrições podem ser aplicadas a uma propriedade de classe (e.g. <tt class="docutils literal"><span class="pre">name</span></tt>) ou
um método getter público (e.g. <tt class="docutils literal"><span class="pre">getFullName</span></tt>). O primeiro é mais comum e fácil
de usar, mas o segundo permite você especificar regras de validação mais complexas.</p>
<div class="section" id="propriedads">
<span id="validation-property-target"></span><span id="index-7"></span><h3>Propriedads<a class="headerlink" href="#propriedads" title="Permalink to this headline">¶</a></h3>
<p>Validar as propriedades de uma classe é a técnica de validação mais básica.Symfony2
permite a você validar propriedades private, protected ou public. A próxima listagem
mostra a você como configurar a propriedade <tt class="docutils literal"><span class="pre">$firstName</span></tt> da classe <tt class="docutils literal"><span class="pre">Author</span></tt>
para ter ao menos 3 caracteres.</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># src/Acme/BlogBundle/Resources/config/validation.yml</span>
<span class="l-Scalar-Plain">Acme\BlogBundle\Entity\Author</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">firstName</span><span class="p-Indicator">:</span>
            <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">NotBlank</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">~</span>
            <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">MinLength</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">3</span>
</pre></div>
</div>
</li>
<li><em>Annotations</em><div class="highlight-php-annotations"><div class="highlight"><pre><span class="c1">// Acme/BlogBundle/Entity/Author.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Constraints</span> <span class="k">as</span> <span class="nx">Assert</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Author</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @Assert\NotBlank()</span>
<span class="sd">     * @Assert\MinLength(3)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$firstName</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- src/Acme/BlogBundle/Resources/config/validation.xml --&gt;</span>
<span class="nt">&lt;class</span> <span class="na">name=</span><span class="s">&quot;Acme\BlogBundle\Entity\Author&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;firstName&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;constraint</span> <span class="na">name=</span><span class="s">&quot;NotBlank&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;constraint</span> <span class="na">name=</span><span class="s">&quot;MinLength&quot;</span><span class="nt">&gt;</span>3<span class="nt">&lt;/constraint&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/class&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Acme/BlogBundle/Entity/Author.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Mapping\ClassMetadata</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Constraints\NotBlank</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Constraints\MinLength</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Author</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$firstName</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">loadValidatorMetadata</span><span class="p">(</span><span class="nx">ClassMetadata</span> <span class="nv">$metadata</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$metadata</span><span class="o">-&gt;</span><span class="na">addPropertyConstraint</span><span class="p">(</span><span class="s1">&#39;firstName&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">NotBlank</span><span class="p">());</span>
        <span class="nv">$metadata</span><span class="o">-&gt;</span><span class="na">addPropertyConstraint</span><span class="p">(</span><span class="s1">&#39;firstName&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">MinLength</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="getters">
<span id="index-8"></span><h3>Getters<a class="headerlink" href="#getters" title="Permalink to this headline">¶</a></h3>
<p>Restrições podem também ser aplicadas no método de retorno de um valor.Symfony2
permite a você adicionar uma restrição para qualquer método public cujo nome comec com
&#8220;get&#8221; ou &#8220;is&#8221;. Nesse guia, ambos os tipos de métodos são referidos
como &#8220;getters&#8221;.</p>
<p>O benefício dessa técnica é que permite a você validar seu objeto
dinamicamente. Por exemplo, suponha que você queira ter certeza que um campo de senha
não coincida com o primeiro nome do usuário (por motivos de segurança). Você pode
fazer isso criando um método <tt class="docutils literal"><span class="pre">isPasswordLegal</span></tt>, e então afirmando que
esse método deva retornar &#8216;&#8217;true&#8217;&#8216;:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># src/Acme/BlogBundle/Resources/config/validation.yml</span>
<span class="l-Scalar-Plain">Acme\BlogBundle\Entity\Author</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">getters</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">passwordLegal</span><span class="p-Indicator">:</span>
            <span class="p-Indicator">-</span> <span class="s">&quot;True&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span> <span class="nv">message</span><span class="p-Indicator">:</span> <span class="s">&quot;The</span><span class="nv"> </span><span class="s">password</span><span class="nv"> </span><span class="s">cannot</span><span class="nv"> </span><span class="s">match</span><span class="nv"> </span><span class="s">your</span><span class="nv"> </span><span class="s">first</span><span class="nv"> </span><span class="s">name&quot;</span> <span class="p-Indicator">}</span>
</pre></div>
</div>
</li>
<li><em>Annotations</em><div class="highlight-php-annotations"><div class="highlight"><pre><span class="c1">// src/Acme/BlogBundle/Entity/Author.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Constraints</span> <span class="k">as</span> <span class="nx">Assert</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Author</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @Assert\True(message = &quot;The password cannot match your first name&quot;)</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">isPasswordLegal</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// return true or false</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- src/Acme/BlogBundle/Resources/config/validation.xml --&gt;</span>
<span class="nt">&lt;class</span> <span class="na">name=</span><span class="s">&quot;Acme\BlogBundle\Entity\Author&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;getter</span> <span class="na">property=</span><span class="s">&quot;passwordLegal&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;constraint</span> <span class="na">name=</span><span class="s">&quot;True&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;option</span> <span class="na">name=</span><span class="s">&quot;message&quot;</span><span class="nt">&gt;</span>The password cannot match your first name<span class="nt">&lt;/option&gt;</span>
        <span class="nt">&lt;/constraint&gt;</span>
    <span class="nt">&lt;/getter&gt;</span>
<span class="nt">&lt;/class&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Acme/BlogBundle/Entity/Author.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Mapping\ClassMetadata</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Constraints\True</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Author</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">loadValidatorMetadata</span><span class="p">(</span><span class="nx">ClassMetadata</span> <span class="nv">$metadata</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$metadata</span><span class="o">-&gt;</span><span class="na">addGetterConstraint</span><span class="p">(</span><span class="s1">&#39;passwordLegal&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="k">True</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;The password cannot match your first name&#39;</span><span class="p">,</span>
        <span class="p">)));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>Agora, crie o método <tt class="docutils literal"><span class="pre">isPasswordLegal()</span></tt> , e inclua a lógica que você precisa:</p>
<div class="highlight-python"><pre>public function isPasswordLegal()
{
    return ($this-&gt;firstName != $this-&gt;password);
}</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Com uma visão apurada, você irá perceber que o prefixo do getter
(&#8220;get&#8221; ou &#8220;is&#8221;) é omitido no mapeamento. Isso permite você mover a
restrição para uma propriedade com o mesmo nome mais tarde (ou vice-versa) sem
mudar sua lógica de validação.</p>
</div>
</div>
<div class="section" id="classes">
<span id="validation-class-target"></span><h3>Classes<a class="headerlink" href="#classes" title="Permalink to this headline">¶</a></h3>
<p>Algumas restrições aplicam para a classe inteira ser validada. Por exemplo,
a restrição <tt class="xref doc docutils literal"><span class="pre">Callback</span></tt> é uma restrição
genérica que é aplicada para a própria classe. Quando a classe é validada,
métodos especificados por aquela restrição são simplesmente executadas então cada um pode
prover uma validação mais personalizada.</p>
</div>
</div>
<div class="section" id="grupos-de-validacao">
<span id="book-validation-validation-groups"></span><h2>Grupos de validação<a class="headerlink" href="#grupos-de-validacao" title="Permalink to this headline">¶</a></h2>
<p>Até agora, você foi capaz de adicionar restrições a uma classe e perguntar se aquela
classe passa ou não por todas as restrições definidas. Em alguns casos, entretanto,
você precisará validar um objeto a somente <em>algumas</em> das restrições
naqula classe. Para fazer isso, você pode organizar cada restrição dentro de um ou mais
&#8220;grupos de validação&#8221;, e então aplicar validação a apenas um grupo de restrições.</p>
<p>Por exemplo, suponha que você tenha uma classe <tt class="docutils literal"><span class="pre">User</span></tt> , que é usada tanto quando um
usuário registra e quando um usuário atualiza sua informações de contato posteriormente:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># src/Acme/BlogBundle/Resources/config/validation.yml</span>
<span class="l-Scalar-Plain">Acme\BlogBundle\Entity\User</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">email</span><span class="p-Indicator">:</span>
            <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Email</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span> <span class="nv">groups</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">registration</span><span class="p-Indicator">]</span> <span class="p-Indicator">}</span>
        <span class="l-Scalar-Plain">password</span><span class="p-Indicator">:</span>
            <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">NotBlank</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span> <span class="nv">groups</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">registration</span><span class="p-Indicator">]</span> <span class="p-Indicator">}</span>
            <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">MinLength</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span> <span class="nv">limit</span><span class="p-Indicator">:</span> <span class="nv">7</span><span class="p-Indicator">,</span> <span class="nv">groups</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">registration</span><span class="p-Indicator">]</span> <span class="p-Indicator">}</span>
        <span class="l-Scalar-Plain">city</span><span class="p-Indicator">:</span>
            <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">MinLength</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">2</span>
</pre></div>
</div>
</li>
<li><em>Annotations</em><div class="highlight-php-annotations"><div class="highlight"><pre><span class="c1">// src/Acme/BlogBundle/Entity/User.php</span>
<span class="k">namespace</span> <span class="nx">Acme\BlogBundle\Entity</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Security\Core\User\UserInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Constraints</span> <span class="k">as</span> <span class="nx">Assert</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">implements</span> <span class="nx">UserInterface</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">    * @Assert\Email(groups={&quot;registration&quot;})</span>
<span class="sd">    */</span>
    <span class="k">private</span> <span class="nv">$email</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">    * @Assert\NotBlank(groups={&quot;registration&quot;})</span>
<span class="sd">    * @Assert\MinLength(limit=7, groups={&quot;registration&quot;})</span>
<span class="sd">    */</span>
    <span class="k">private</span> <span class="nv">$password</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">    * @Assert\MinLength(2)</span>
<span class="sd">    */</span>
    <span class="k">private</span> <span class="nv">$city</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- src/Acme/BlogBundle/Resources/config/validation.xml --&gt;</span>
<span class="nt">&lt;class</span> <span class="na">name=</span><span class="s">&quot;Acme\BlogBundle\Entity\User&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;email&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;constraint</span> <span class="na">name=</span><span class="s">&quot;Email&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;option</span> <span class="na">name=</span><span class="s">&quot;groups&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;value&gt;</span>registration<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;/option&gt;</span>
        <span class="nt">&lt;/constraint&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;constraint</span> <span class="na">name=</span><span class="s">&quot;NotBlank&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;option</span> <span class="na">name=</span><span class="s">&quot;groups&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;value&gt;</span>registration<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;/option&gt;</span>
        <span class="nt">&lt;/constraint&gt;</span>
        <span class="nt">&lt;constraint</span> <span class="na">name=</span><span class="s">&quot;MinLength&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;option</span> <span class="na">name=</span><span class="s">&quot;limit&quot;</span><span class="nt">&gt;</span>7<span class="nt">&lt;/option&gt;</span>
            <span class="nt">&lt;option</span> <span class="na">name=</span><span class="s">&quot;groups&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;value&gt;</span>registration<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;/option&gt;</span>
        <span class="nt">&lt;/constraint&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;city&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;constraint</span> <span class="na">name=</span><span class="s">&quot;MinLength&quot;</span><span class="nt">&gt;</span>7<span class="nt">&lt;/constraint&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/class&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Acme/BlogBundle/Entity/User.php</span>
<span class="k">namespace</span> <span class="nx">Acme\BlogBundle\Entity</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Mapping\ClassMetadata</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Constraints\Email</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Constraints\NotBlank</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Constraints\MinLength</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">loadValidatorMetadata</span><span class="p">(</span><span class="nx">ClassMetadata</span> <span class="nv">$metadata</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$metadata</span><span class="o">-&gt;</span><span class="na">addPropertyConstraint</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Email</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;groups&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;registration&#39;</span><span class="p">)</span>
        <span class="p">)));</span>

        <span class="nv">$metadata</span><span class="o">-&gt;</span><span class="na">addPropertyConstraint</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">NotBlank</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;groups&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;registration&#39;</span><span class="p">)</span>
        <span class="p">)));</span>
        <span class="nv">$metadata</span><span class="o">-&gt;</span><span class="na">addPropertyConstraint</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">MinLength</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;limit&#39;</span>  <span class="o">=&gt;</span> <span class="mi">7</span><span class="p">,</span>
            <span class="s1">&#39;groups&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;registration&#39;</span><span class="p">)</span>
        <span class="p">)));</span>

        <span class="nv">$metadata</span><span class="o">-&gt;</span><span class="na">addPropertyConstraint</span><span class="p">(</span><span class="s1">&#39;city&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">MinLength</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>Com essa configuração, existem dois grupos de validação:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">Default</span></tt> - contém as restrições não atribuidas a qualquer outro grupo;</li>
<li><tt class="docutils literal"><span class="pre">registration</span></tt> - Contém as restrições somente nos campos <tt class="docutils literal"><span class="pre">email</span></tt> e <tt class="docutils literal"><span class="pre">password</span></tt>.</li>
</ul>
<p>Para avisar o validador a usar um grupo específico, passe um ou mais nomes de trupos
como um segundo argumento para o método``validate()``</p>
<blockquote>
<div>$errors = $validator-&gt;validate($author, array(&#8216;registration&#8217;));</div></blockquote>
<p>Claro, você irá frequentemente trabalhar com validação indiretamnte por meio
da biblioteca do formulário. Para informações em como usar grupos de validação dentro de formulários,
veja <a class="reference internal" href="forms.html#book-forms-validation-groups"><em>Grupos de Validação</em></a>.</p>
</div>
<div class="section" id="validando-valores-e-arrays">
<span id="book-validation-raw-values"></span><span id="index-9"></span><h2>Validando Valores e Arrays<a class="headerlink" href="#validando-valores-e-arrays" title="Permalink to this headline">¶</a></h2>
<p>Até agora, você viu como pode validar objetos inteiros. Mas às vezes, você
somente quer validar um valor simples - como verificar se uma string é um endereço
de e-mail válido. Isso é realmente muito fácil de fazer. De dentro do controller,
parece com isso:</p>
<blockquote>
<div><p>// add this to the top of your class
use SymfonyComponentValidatorConstraintsEmail;</p>
<p>public function addEmailAction($email)
{</p>
<blockquote>
<div><p>$emailConstraint = new Email();
// all constraint &#8220;options&#8221; can be set this way
$emailConstraint-&gt;message = &#8216;Invalid email address&#8217;;</p>
<p>// use the validator to validate the value
$errorList = $this-&gt;get(&#8216;validator&#8217;)-&gt;validateValue($email, $emailConstraint);</p>
<dl class="docutils">
<dt>if (count($errorList) == 0) {</dt>
<dd>// this IS a valid email address, do something</dd>
<dt>} else {</dt>
<dd><p class="first">// this is <em>not</em> a valid email address
$errorMessage = $errorList[0]-&gt;getMessage()</p>
<p class="last">// do somethign with the error</p>
</dd>
</dl>
<p>}</p>
<p>// ...</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>Ao chamar <tt class="docutils literal"><span class="pre">validateValue</span></tt> no validador, você pode passar um valor bruto e
o objeto de restrição que você com o qual você quer validar aquele valor. Uma lista
completa de restrições disponíveis - bem como o nome inteiro da classe para cada
restrição - está disponível em <a class="reference internal" href="../reference/constraints.html"><em>constraints reference</em></a>
section .</p>
<p>O método <tt class="docutils literal"><span class="pre">validateValule</span></tt> retorna um objeto <tt class="docutils literal"><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Validator/ConstraintViolationList.html" title="Symfony\Component\Validator\ConstraintViolationList"><span class="pre">ConstraintViolationList</span></a></tt>
, que age como um array de erros. Cada erro na coleção é um objeto :
class:<cite>Symfony\Component\Validator\ConstraintViolation</cite> ,
que contém a mensagem de erro no método <cite>getMessage</cite> dele.</p>
</div>
<div class="section" id="consideracoes-finais">
<h2>Considerações Finais<a class="headerlink" href="#consideracoes-finais" title="Permalink to this headline">¶</a></h2>
<p>O Symfony2 <tt class="docutils literal"><span class="pre">validator</span></tt> é uma ferramenta poderosa que pode ser multiplicada para
garantir que o dado de qualquer objeto seja &#8220;válido&#8221;. O poder por trás da validação
rside em &#8220;restrições&#8221;, que seão regras que você pode aplicar a propriedades ou métodos
getter de seus objetos. E enquanto você irá usar mais frequentemente usar a validação
do framework indiretamente quando usar formulários, lembre que isso pode ser usado
em qualquer lugar para validar qualquer objeto.</p>
</div>
<div class="section" id="aprenda-mais-do-cookbook">
<h2>Aprenda mais do Cookbook<a class="headerlink" href="#aprenda-mais-do-cookbook" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="../cookbook/validation/custom_constraint.html"><em>Como criar uma Regra de Validação Personalizada</em></a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Validação</a><ul>
<li><a class="reference internal" href="#as-bases-da-validacao">As bases da validação</a><ul>
<li><a class="reference internal" href="#usando-o-servico-validator">Usando o serviço <tt class="docutils literal"><span class="pre">validator</span></tt></a></li>
<li><a class="reference internal" href="#validacao-e-formularios">Validação e formulários</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuracao">Configuração</a></li>
<li><a class="reference internal" href="#restricoes">Restrições</a><ul>
<li><a class="reference internal" href="#resticoes-suportadas">Restições Suportadas</a></li>
<li><a class="reference internal" href="#configuracao-de-restricoes">Configuração de restrições</a></li>
</ul>
</li>
<li><a class="reference internal" href="#escopos-da-restricao">Escopos da restrição</a><ul>
<li><a class="reference internal" href="#propriedads">Propriedads</a></li>
<li><a class="reference internal" href="#getters">Getters</a></li>
<li><a class="reference internal" href="#classes">Classes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#grupos-de-validacao">Grupos de validação</a></li>
<li><a class="reference internal" href="#validando-valores-e-arrays">Validando Valores e Arrays</a></li>
<li><a class="reference internal" href="#consideracoes-finais">Considerações Finais</a></li>
<li><a class="reference internal" href="#aprenda-mais-do-cookbook">Aprenda mais do Cookbook</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="testing.html"
                        title="previous chapter">Testes</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="forms.html"
                        title="next chapter">Formulários</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/book/validation.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="forms.html" title="Formulários"
             >next</a> |</li>
        <li class="right" >
          <a href="testing.html" title="Testes"
             >previous</a> |</li>
        <li><a href="../index.html">Symfony2Docs 2.0.x documentation</a> &raquo;</li>
          <li><a href="index.html" >Livro</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Symfony Team.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>